<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Soto Lamongan - Kuliner Khas Lamongan</title>
    <!-- SEO Improvement -->
    <meta name="description" content="Warung Soto Lamongan asli dengan cita rasa autentik, resep turun-temurun.">
    <meta property="og:title" content="Soto Lamongan Asli">
    <meta property="og:image" content="soto.png">
    <link rel="manifest" href="manifest.json">
    <!-- Libraries -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.29/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <!-- Tambahkan kode ini di dalam bagian header aplikasi utama -->
<style>
    /* Reset dan Styling Dasar */
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    body {
        background-color: #f9f5eb;
        color: #333;
        line-height: 1.6;
    }

    .restaurant-header {
        background: linear-gradient(rgba(0, 0, 0, 0.7), rgba(0, 0, 0, 0.7)), url('rafa.jpeg');
        background-size: cover;
        background-position: center;
        color: white;
        padding: 40px 20px;
        text-align: center;
        border-radius: 10px;
        margin-bottom: 20px;
    }

    .restaurant-header h1 {
        font-size: 2.5rem;
        margin-bottom: 10px;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
    }

    .restaurant-header p {
        font-size: 1.2rem;
        margin-bottom: 20px;
        text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
    }

    .restaurant-tagline {
        font-style: italic;
        font-size: 1.1rem;
        color: #f39c12;

    }
</style>
    <style>
        /* Reset dan Styling Dasar */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f9f5eb;
            color: #333;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Header */
        header {
            background-color: #e63946;
            color: white;
            padding: 20px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .nav-toggle {
            display: none; /* Sembunyikan di desktop */
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
        }

        .logo h1 {
            font-size: 28px;
            margin-left: 10px;
        }

        nav ul {
            display: flex;
            list-style: none;
        }

        nav ul li {
            margin-left: 25px;
        }

        nav ul li a {
            color: white;
            text-decoration: none;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        nav ul li a:hover {
            color: #ffd166;
        }

        /* Hero Section */
        .hero {
            background: linear-gradient(rgba(0,0,0,0.5), rgba(0,0,0,0.5)), url('https://www.bing.com/ck/a?!&&p=a005d741fa502d06d2ad774a1c3526b07c52c72743154df5a18c5945d9240bc9JmltdHM9MTc2MjU2MDAwMA&ptn=3&ver=2&hsh=4&fclid=022f94bd-ac59-66a8-238c-82c1ad1e679c&u=a1L2ltYWdlcy9zZWFyY2g_cT1sb2dvK2VsK3JhaG1hJmlkPUM2OUQxMERDQUM1MzE3NkU5NTA5MTQ5NzcyODExRjdGMTg2RTI2RTMmRk9STT1JQUNGSVI&ntb=1') no-repeat center center/cover;
            background: linear-gradient(rgba(0,0,0,0.5), rgba(0,0,0,0.5)), url('soto.png') no-repeat center center/cover;
            height: 300px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            color: white;
            padding: 0 20px;
        }

        .hero-content h2 {
            font-size: 48px;
            margin-bottom: 15px;
            text-shadow: 2px 2px 5px rgba(0,0,0,0.5);
        }

        .hero-content p {
            font-size: 20px;
            max-width: 650px;
            margin: 0 auto 30px;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.5);
        }

        .btn {
            display: inline-block;
            background-color: #e63946;
            color: white;
            padding: 12px 30px;
            border-radius: 5px;
            text-decoration: none;
            font-weight: bold;
            transition: all 0.3s ease;
            border: none;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            cursor: pointer;
        }
        
        /* Efek transisi umum untuk semua tombol */
        .btn, .btn-kasir, .btn-small, .category-btn-kasir, .quantity-btn-kasir {
            transition: all 0.3s ease;
        }

        .btn:hover {
            background-color: #d62839;
            transform: translateY(-3px);
        }

        .btn-outline {
            background-color: transparent;
            border: 2px solid #e63946;
            color: #e63946;
        }

        .btn-outline:hover {
            background-color: #e63946;
            color: white;
        }

        /* Section Styling */
        section {
            padding: 80px 0;
        }

        .section-title {
            text-align: center;
            margin-bottom: 50px;
        }

        .section-title h2 {
            font-size: 36px;
            color: #e63946;
            position: relative;
            display: inline-block;
            padding-bottom: 10px;
        }

        .section-title h2::after {
            content: '';
            position: absolute;
            width: 70px;
            height: 3px;
            background-color: #e63946;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
        }

        /* Tentang Section */
        .about-content {
            display: flex;
            align-items: center;
            gap: 40px;
        }

        .about-text {
            flex: 1;
        }

        .about-image {
            flex: 1;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .about-image img {
            width: 100%;
            height: auto;
            display: block;
            transition: transform 0.5s ease;
        }

        .about-image:hover img {
            transform: scale(1.05);
        }

        /* Lokasi Section */
        .location-content {
            display: flex;
            gap: 40px;
        }

        .location-info {
            flex: 1;
        }

        .location-map {
            flex: 1;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .location-map iframe {
            width: 100%;
            height: 100%;
            min-height: 300px;
            border: none;
        }

        /* Testimoni Section */
        .testimonials {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
        }

        .testimonial {
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .testimonial-text {
            font-style: italic;
            margin-bottom: 20px;
        }

        .testimonial-author {
            display: flex;
            align-items: center;
        }

        .testimonial-author img {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            object-fit: cover;
            margin-right: 15px;
        }

        .testimonial:hover {
            transform: translateY(-10px);
            box-shadow: 0 15px 30px rgba(0,0,0,0.15);
        }

        /* Galeri Section */
        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .gallery-item {
            position: relative;
            border-radius: 10px;
            overflow: hidden;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .gallery-item img {
            width: 100%;
            height: 250px;
            object-fit: cover;
            display: block;
            transition: transform 0.4s ease;
        }

        .gallery-item:hover img {
            transform: scale(1.1);
        }

        .gallery-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(230, 57, 70, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-size: 30px;
            opacity: 0;
            transition: opacity 0.4s ease;
        }

        .gallery-item:hover .gallery-overlay {
            opacity: 1;
        }

        /* Lightbox Modal */
        .lightbox-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.85);
            z-index: 1001;
            justify-content: center;
            align-items: center;
            padding: 20px;
            animation: fadeIn 0.3s ease;
        }

        /* Footer */
        footer {
            background-color: #333;
            color: white;
            padding: 50px 0 20px;
        }

        .footer-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 40px;
            margin-bottom: 40px;
        }

        .footer-column h3 {
            font-size: 20px;
            margin-bottom: 20px;
            color: #e63946;
        }

        .footer-column ul {
            list-style: none;
        }

        .footer-column ul li {
            margin-bottom: 10px;
        }

        .footer-column ul li a {
            color: #ddd;
            text-decoration: none;
            transition: color 0.3s ease;
        }

        .footer-column ul li a:hover {
            color: #e63946;
        }

        .social-links {
            display: flex;
            gap: 15px;
        }

        .social-links a {
            display: inline-block;
            width: 40px;
            height: 40px;
            background-color: #444;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            text-decoration: none;
            transition: background-color 0.3s ease;
        }

        .social-links a:hover {
            background-color: #e63946;
        }

        .copyright {
            text-align: center;
            padding-top: 20px;
            border-top: 1px solid #444;
            font-size: 14px;
        }

        /* Modal Styling */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.7);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal-content {
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            width: 100%;
            max-width: 500px;
            box-shadow: 0 5px 25px rgba(0,0,0,0.2);
            animation: zoomIn 0.3s ease-out; /* Animasi saat modal muncul */
            max-height: 90vh;
            overflow-y: auto;
        }
        
        @keyframes zoomIn {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }

        .modal-header h2 {
            color: #e63946;
            margin: 0;
        }

        .close {
            font-size: 24px;
            cursor: pointer;
            color: #777;
            background: none;
            border: none;
        }

        .close:hover {
            color: #e63946;
        }

        /* Form Styling */
        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .form-group input, .form-group textarea, .form-group select {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }

        .form-row {
            display: flex;
            gap: 15px;
        }

        .form-row .form-group {
            flex: 1;
        }

        .form-footer {
            margin-top: 20px;
            text-align: center;
        }

        .form-footer a {
            color: #e63946;
            text-decoration: none;
        }

        .form-footer a:hover {
            text-decoration: underline;
        }

        /* Dashboard */
        .dashboard {
            display: none;
            min-height: 100vh;
            background-color: #f5f5f5;
        }

        .dashboard-header {
            background-color: #e63946;
            color: white;
            padding: 15px 0;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .sidebar-toggle {
            display: none; /* Sembunyikan di desktop */
            background: none;
            border: none;
            color: white;
            font-size: 22px;
            cursor: pointer;
            margin-right: 15px;
        }

        .dashboard-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .dashboard-nav ul {
            display: flex;
            list-style: none;
        }

        .dashboard-nav ul li {
            margin-left: 20px;
        }

        .dashboard-nav ul li a {
            color: white;
            text-decoration: none;
        }

        .dashboard-content {
            display: flex;
        }

        .sidebar {
            width: 250px;
            background-color: #333;
            color: white;
            min-height: calc(100vh - 70px);
            padding: 20px 0;
        }

        .sidebar ul {
            list-style: none;
        }

        .sidebar ul li {
            padding: 15px 20px;
            border-bottom: 1px solid #444;
            cursor: pointer;
        }

        .sidebar ul li a {
            color: white;
            text-decoration: none;
            display: flex;
            align-items: center;
        }

        .sidebar ul li a i {
            margin-right: 10px;
            width: 20px;
            text-align: center;
        }

        .sidebar ul li.active {
            background-color: #e63946;
        }

        .main-content {
            flex: 1;
            padding: 30px;
        }

        .dashboard-section {
            display: none;
            background-color: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            margin-bottom: 30px;
        }

        .dashboard-section.active {
            display: block;
        }

        .stats-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            text-align: center;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(230, 57, 70, 0.15);
        }


        .stat-card h3 {
            font-size: 14px;
            color: #777;
            margin-bottom: 10px;
        }

        .stat-card .value {
            font-size: 28px;
            font-weight: bold;
            color: #e63946;
        }

        /* Kasir Styling */
        .kasir-container {
            display: flex;
            gap: 20px;
            height: calc(100vh - 200px);
        }

        .menu-kasir {
            flex: 1;
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            overflow-y: auto;
        }

        .keranjang-kasir {
            width: 350px;
            min-width: 320px;
            background-color: white;
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            display: flex;
            flex-direction: column;
        }

        .menu-categories-kasir {
            display: flex;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .category-btn-kasir {
            padding: 8px 16px;
            background-color: #f1faee;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .category-btn-kasir.active {
            background-color: #e63946;
            color: white;
        }

        .menu-items-kasir {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
        }

        .menu-item-kasir {
            background-color: #f9f9f9;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid #eee;
        }

        .menu-item-kasir img {
            width: 100%;
            height: 100px;
            object-fit: cover;
            border-radius: 5px;
            margin-bottom: 10px;
        }

        .menu-item-kasir:hover {
            background-color: #e63946;
            color: white;
            transform: translateY(-3px);
        }

        .menu-item-kasir h4 {
            margin-bottom: 5px;
            font-size: 14px;
        }

        .menu-item-kasir .price {
            font-weight: bold;
            color: #e63946;
            font-size: 13px;
        }

        .menu-item-kasir:hover .price {
            color: white;
        }

        .keranjang-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }

        .keranjang-items {
            flex: 1;
            overflow-y: auto;
            margin-bottom: 20px;
        }

        .keranjang-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #eee;
        }

        .keranjang-item:last-child {
            border-bottom: none;
        }

        .keranjang-item-info {
            flex: 1;
        }

        .keranjang-item-name {
            font-weight: bold;
            margin-bottom: 5px;
            font-size: 14px;
        }

        .keranjang-item-price {
            color: #e63946;
            font-weight: bold;
            font-size: 13px;
        }

        .keranjang-item-controls {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .quantity-btn-kasir {
            width: 25px;
            height: 25px;
            border-radius: 50%;
            border: 1px solid #ddd;
            background-color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }

        .keranjang-item-quantity {
            font-weight: bold;
            min-width: 25px;
            text-align: center;
            font-size: 14px;
        }

        .keranjang-total {
            margin-top: 20px;
            padding-top: 15px;
            border-top: 2px solid #eee;
            display: flex;
            justify-content: space-between;
            font-size: 18px;
            font-weight: bold;
        }

        .keranjang-actions {
            margin-top: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .btn-kasir {
            padding: 12px 8px;
            border: none;
            border-radius: 5px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            font-size: 13px;
            width: 100%;
            margin-bottom: 8px;
            min-width: 0;
        }

        .btn-kasir-primary {
            background-color: #2a9d8f;
            color: white;
        }

        .btn-kasir-primary:hover {
            background-color: #21867a;
        }

        .btn-kasir-secondary {
            background-color: #e63946;
            color: white;
        }

        .btn-kasir-secondary:hover {
            background-color: #d62839;
        }

        .btn-kasir-outline {
            background-color: transparent;
            border: 1px solid #e63946;
            color: #e63946;
        }

        .btn-kasir-outline:hover {
            background-color: #e63946;
            color: white;
        }

        /* Receipt Styling */
        .receipt {
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            max-width: 400px;
            margin: 0 auto;
        }

        .receipt-header {
            text-align: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px dashed #e63946;
        }

        .receipt-header h2 {
            color: #e63946;
            margin-bottom: 5px;
        }

        .receipt-info {
            margin-bottom: 20px;
        }

        .receipt-info p {
            margin-bottom: 5px;
        }

        .receipt-items {
            width: 100%;
            margin-bottom: 20px;
        }

        .receipt-items th {
            text-align: left;
            padding: 8px 0;
            border-bottom: 1px solid #eee;
        }

        .receipt-items td {
            padding: 8px 0;
            border-bottom: 1px solid #eee;
        }

        .receipt-total {
            margin-top: 20px;
            padding-top: 15px;
            border-top: 2px solid #eee;
            display: flex;
            justify-content: space-between;
            font-size: 18px;
            font-weight: bold;
        }

        .receipt-footer {
            text-align: center;
            margin-top: 20px;
            padding-top: 15px;
            border-top: 2px dashed #e63946;
            font-style: italic;
            color: #777;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        table th, table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        table th {
            background-color: #f5f5f5;
            font-weight: 600;
        }

        .btn-small {
            padding: 8px 15px;
            font-size: 14px;
        }

        .btn-success {
            background-color: #2a9d8f;
        }

        .btn-danger {
            background-color: #e63946;
        }

        /* User Management */
        .user-role-selector {
            display: flex;
            margin-bottom: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
            overflow: hidden;
        }

        .user-role {
            flex: 1;
            padding: 10px;
            text-align: center;
            cursor: pointer;
            background-color: #f9f9f9;
            transition: all 0.3s ease;
        }

        .user-role.active {
            background-color: #e63946;
            color: white;
        }

        /* Wrapper untuk tabel agar bisa scroll horizontal */
        .table-wrapper {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch; /* Scroll lebih mulus di iOS */
        }

        /* Sidebar untuk mobile */
        .sidebar.open {
            transform: translateX(0);
            box-shadow: 0 0 15px rgba(0,0,0,0.2);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                text-align: center;
            }

            .nav-toggle {
                display: block; /* Tampilkan di mobile */
                position: absolute;
                top: 20px;
                right: 20px;
            }

            nav ul {
                display: none; /* Sembunyikan menu utama */
                flex-direction: column;
                width: 100%;
                background-color: #d62839; /* Warna sedikit lebih gelap */
                position: absolute;
                top: 70px; /* Sesuaikan dengan tinggi header */
                left: 0;
                padding: 10px 0;
            }

            nav ul.active {
                display: flex; /* Tampilkan saat di-klik */
            }

            nav ul li {
                margin: 5px 10px;
            }

            .hero-content h2 {
                font-size: 36px;
            }

            .about-content, .location-content {
                flex-direction: column;
            }

            section {
                padding: 50px 0;
            }

            .dashboard-content {
                flex-direction: column;
            }

            .sidebar {
                width: 100%;
                max-width: 280px;
                min-height: auto;
                position: fixed;
                top: 0;
                left: 0;
                height: 100%;
                z-index: 1100;
                transform: translateX(-100%);
                transition: transform 0.3s ease-in-out;
            }

            .sidebar-toggle {
                display: block; /* Tampilkan tombol sidebar di mobile */
            }

            .kasir-container {
                flex-direction: column;
                height: auto;
            }

            .keranjang-kasir {
                width: 100%;
                margin-top: 20px;
            }

            .form-row {
                flex-direction: column;
                gap: 0;
            }

            .menu-items-kasir {
                grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
                gap: 10px;
            }

            .stats-cards {
                grid-template-columns: 1fr; /* Kartu statistik menjadi satu kolom */
                gap: 15px;
            }

            .btn-kasir {
                font-size: 12px;
                padding: 10px 6px;
            }
        }

        /* Back to Top Button */
        .back-to-top-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 50px;
            height: 50px;
            background-color: #e63946;
            color: white;
            border-radius: 50%;
            text-align: center;
            font-size: 20px;
            line-height: 50px;
            z-index: 999;
            cursor: pointer;
            transition: opacity 0.4s, transform 0.4s, visibility 0.4s;
            opacity: 0;
            transform: translateY(100px);
            visibility: hidden;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }

        .back-to-top-btn.show {
            opacity: 1;
            transform: translateY(0);
            visibility: visible;
        }

        .back-to-top-btn:hover {
            background-color: #d62839;
        }

        /* Efek hover pada baris tabel di dashboard */
        table tbody tr {
            transition: background-color 0.2s ease;
        }

        table tbody tr:hover {
            background-color: #f1faee; /* Warna hijau muda yang sesuai tema */
            cursor: pointer;
        }
        
        /* Stock Status Badges */
        .stock-badge {
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
        }
        .stock-ok { background-color: #d4edda; color: #155724; }
        .stock-low { background-color: #fff3cd; color: #856404; }
        .stock-out { background-color: #f8d7da; color: #721c24; }

        /* Search Bar & Filters */
        .search-container {
            margin-bottom: 15px;
        }
        .search-input {
            width: 100%;
            padding: 10px 15px;
            border: 1px solid #ddd;
            border-radius: 20px;
            font-size: 14px;
            outline: none;
            transition: border-color 0.3s;
        }
        .search-input:focus {
            border-color: #e63946;
        }
        .filter-container {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            align-items: center;
            background: #f9f9f9;
            padding: 10px;
            border-radius: 5px;
        }
        /* Activity Log Styles */
        .log-entry {
            font-size: 13px;
            padding: 8px;
            border-bottom: 1px solid #eee;
        }
        .log-time { color: #888; font-size: 11px; }
        .log-action { font-weight: bold; color: #333; }
        .log-user { color: #e63946; }

        /* Loading Overlay */
        #loading-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.8);
            z-index: 9999;
            justify-content: center;
            align-items: center;
        }
        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid #e63946;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Pagination Controls */
        .pagination-controls {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
        }

        /* PWA Install Button */
        #pwaInstallBtn {
            display: none;
            position: fixed;
            bottom: 90px;
            right: 30px;
            z-index: 998;
            background-color: #333;
            color: white;
            border-radius: 50px;
        }
    </style>
</head>

<body>
    <!-- Header -->
    <header>
        <div class="container header-content">
            <div class="logo">
                <h1>Soto Lamongan</h1>
            </div>
            <nav id="mainNav">
                <ul id="mainNavMenu">
                    <li><a href="#tentang">Tentang</a></li>
                    <li><a href="#lokasi">Lokasi</a></li>
                    <li><a href="#testimoni">Testimoni</a></li>
                    <li><a href="#kontak">Kontak</a></li>
                    <li><a href="#" id="loginBtn">Login</a></li>
                </ul>
            </nav>
            <button class="nav-toggle" id="navToggle" aria-label="Buka menu navigasi"><i class="fas fa-bars"></i></button>
        </div>
    </header>

    <!-- Hero Section -->
    <section class="hero">
        <div class="hero-content">
            <h2>Soto Lamongan Asli</h2>
            <p class="animate__animated animate__fadeInUp animate__delay-1s">Rasakan kelezatan soto ayam khas Lamongan dengan cita rasa autentik yang menggugah selera</p>
            <a href="#tentang" class="btn">silahkan masuk</a>
        </div>
    </section>

    <!-- Tentang Section -->
    <section id="tentang">
        <div class="container">
            <div class="section-title">
                <h2>Tentang Soto Lamongan</h2>
            </div>
            <div class="about-content">
                <div class="about-text">
                    <p>Soto Lamongan adalah salah satu kuliner khas Indonesia yang berasal dari Lamongan, Jawa Timur. Soto ini memiliki ciri khas kuah kuning yang gurih dengan tambahan koya, yaitu campuran kerupuk udang dan bawang putih yang dihaluskan.</p>
                    <p>Keunikan soto Lamongan terletak pada penggunaan bumbu rempah yang khas serta penyajiannya yang dilengkapi dengan suwiran ayam, tauge, seledri, daun bawang, dan telur rebus. Tidak lupa, soto ini selalu disajikan dengan nasi putih hangat dan sambal.</p>
                    <p>Di warung kami, kami menggunakan resep turun-temurun yang telah diwariskan selama beberapa generasi untuk memastikan cita rasa autentik soto Lamongan tetap terjaga.</p>
                </div>
                <div class="about-image">
                    <img src="rafa.jpeg" alt="Soto Lamongan">
                </div>
            </div>
        </div>
    </section>

    <!-- Lokasi Section -->
    <section id="lokasi">
        <div class="container">
            <div class="section-title">
                <h2>Lokasi Kami</h2>
            </div>
            <div class="location-content">
                <div class="location-info">
                    <h3>Warung Soto Cak Har</h3>
                    <p>Jl. Merdeka No. 14, Pusat Kota, Lamongan, Jawa Timur</p>
                    <p>Buka setiap hari:</p>
                    <p>Senin - Jumat: 08.00 - 20.00 WIB</p>
                    <p>Sabtu - Minggu: 08.00 - 22.00 WIB</p>
                    <p>Telepon: 0812-3456-7890</p>
                    <p>Email: kontak@sotocakhar.com</p>
                </div>
                <div class="location-map">
                    <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3957.715178559567!2d112.41427407499654!3d-7.268465392732326!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x2e7805b56c6e0e4f%3A0x6f6b8f9b8f9b8f9b!2sLamongan%2C%20Jawa%20Timur!5e0!3m2!1sid!2sid!4v1647856789012!5m2!1sid!2sid" allowfullscreen="" loading="lazy"></iframe>
                </div>
            </div>
        </div>
    </section>

    <!-- Testimoni Section -->
    <section id="testimoni" style="background-color: #f1faee;">
        <div class="container">
            <div class="section-title">
                <h2>Testimoni Pelanggan</h2>
            </div>
            <div class="testimonials">
                <div class="testimonial">
                    <div class="testimonial-text">
                        "Soto Lamongan di sini benar-benar autentik! Rasanya persis seperti yang saya makan waktu berkunjung ke Lamongan. Koyanya yang gurih membuat soto ini semakin istimewa."
                    </div>
                    <div class="testimonial-author">
                        <img src="kakek.jpeg" alt="Pelanggan">
                        <div>
                            <h4>Budi Santoso</h4>
                            <p>Pelanggan Setia</p>
                        </div>
                    </div>
                </div>
                <div class="testimonial">
                    <div class="testimonial-text">
                        "Tempat yang nyaman dengan pelayanan ramah. Soto ayamnya lezat dan harganya terjangkau. Sudah berkali-kali makan di sini dan tidak pernah kecewa."
                    </div>
                    <div class="testimonial-author">
                        <img src="senyum.jpeg" alt="Pelanggan">
                        <div>
                            <h4>Sari Indah</h4>
                            <p>Pelanggan</p>
                        </div>
                    </div>
                </div>
                <div class="testimonial">
                    <div class="testimonial-text">
                        "Sebagai orang Lamongan asli, saya bisa membuktikan bahwa soto di tempat ini benar-benar otentik. Rasa kuah dan koyanya persis seperti di kampung halaman saya."
                    </div>
                    <div class="testimonial-author">
                        <img src="cowok.jpeg" alt="Pelanggan">
                        <div>
                            <h4>Ahmad Fauzi</h4>
                            <p>Warga Lamongan</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer id="kontak">
        <div class="container">
            <div class="footer-content">
                <div class="footer-column">
                    <h3>Soto Lamongan</h3>
                    <p>Warung Soto Lamongan Asli dengan cita rasa autentik yang telah diwariskan turun-temurun.</p>
                    <div class="social-links">
                        <a href="#"><i class="fab fa-facebook-f"></i></a>
                        <a href="#"><i class="fab fa-instagram"></i></a>
                        <a href="#"><i class="fab fa-twitter"></i></a>
                        <a href="#"><i class="fab fa-youtube"></i></a>
                    </div>
                </div>
                <div class="footer-column">
                    <h3>Kontak Kami</h3>
                    <ul>
                        <li>Jl. Merdeka No. 14, Pusat Kota</li>
                        <li>Lamongan, Jawa Timur</li>
                        <li>Telepon: 0812-3456-7890</li>
                        <li>Email: kontak@sotocakhar.com</li>
                    </ul>
                </div>
                <div class="footer-column">
                    <h3>Jam Operasional</h3>
                    <ul>
                        <li>Senin - Jumat: 08.00 - 20.00 WIB</li>
                        <li>Sabtu - Minggu: 08.00 - 22.00 WIB</li>
                    </ul>
                </div>
            </div>
            <div class="copyright">
                <p>&copy; 2025 Soto Lamongan. All Rights Reserved.</p>
            </div>
        </div>
    </footer>

    <!-- Login Modal -->
    <div id="loginModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Login</h2>
                <button class="close" aria-label="Tutup modal">&times;</button>
            </div>
            <div class="user-role-selector">
                <div class="user-role active" data-role="kasir">Kasir</div>
                <div class="user-role" data-role="admin">Admin</div>
            </div>
            <form id="loginForm">
                <div class="form-group">
                    <label for="username">Username</label>
                    <input type="text" id="username" placeholder="Masukkan username" required>
                </div>
                <div class="form-group">
                    <label for="password">Password</label>
                    <input type="password" id="password" placeholder="Masukkan password" required>
                </div>
                <button type="submit" class="btn" style="width: 100%;">Login</button>
                <div class="form-footer">
                    <p><a href="#" id="forgotPasswordLink">Lupa Password?</a></p>
                    <p><a href="#" id="createAccountLink">Buat Akun Baru</a></p>
                </div>
            </form>
        </div>
    </div>

    <!-- Forgot Password Modal -->
    <div id="forgotPasswordModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Lupa Password</h2>
                <button class="close" aria-label="Tutup modal">&times;</button>
            </div>
            <form id="forgotPasswordForm">
                <div class="form-group">
                    <label for="forgotUsername">Username</label>
                    <input type="text" id="forgotUsername" placeholder="Masukkan username Anda" required>
                </div>
                <div class="form-group">
                    <label for="forgotEmail">Email</label>
                    <input type="email" id="forgotEmail" placeholder="Masukkan email Anda" required>
                </div>
                <button type="submit" class="btn" style="width: 100%;">Reset Password</button>
                <div class="form-footer">
                    <p><a href="#" id="backToLoginFromForgot">Kembali ke Login</a></p>
                </div>
            </form>
        </div>
    </div>

    <!-- Reset Password Modal -->
    <div id="resetPasswordModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Ganti Password</h2>
                <button class="close" aria-label="Tutup modal">&times;</button>
            </div>
            <form id="resetPasswordForm">
                <input type="hidden" id="resetUsername">
                <div class="form-group">
                    <label for="resetNewPassword">Password Baru</label>
                    <input type="password" id="resetNewPassword" placeholder="Masukkan password baru" required>
                </div>
                <div class="form-group">
                    <label for="resetConfirmPassword">Konfirmasi Password Baru</label>
                    <input type="password" id="resetConfirmPassword" placeholder="Konfirmasi password baru" required>
                </div>
                <button type="submit" class="btn" style="width: 100%;">Ganti Password</button>
            </form>
        </div>
    </div>

    <!-- Create Account Modal -->
    <div id="createAccountModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Buat Akun Baru</h2>
                <button class="close" aria-label="Tutup modal">&times;</button>
            </div>
            <div class="user-role-selector">
                <div class="user-role active" data-role="kasir">Kasir</div>
                <div class="user-role" data-role="admin">Admin</div>
            </div>
            <form id="createAccountForm">
                <div class="form-group">
                    <label for="newUsername">Username</label>
                    <input type="text" id="newUsername" placeholder="Buat username" required>
                </div>
                <div class="form-group">
                    <label for="newEmail">Email</label>
                    <input type="email" id="newEmail" placeholder="Masukkan email" required>
                </div>
                <div class="form-group">
                    <label for="newPassword">Password</label>
                    <input type="password" id="newPassword" placeholder="Buat password" required>
                </div>
                <div class="form-group">
                    <label for="confirmPassword">Konfirmasi Password</label>
                    <input type="password" id="confirmPassword" placeholder="Konfirmasi password" required>
                </div>
                <button type="submit" class="btn" style="width: 100%;">Buat Akun</button>
                <div class="form-footer">
                    <p><a href="#" id="backToLoginFromCreate">Kembali ke Login</a></p>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Menu Modal -->
    <div id="addMenuModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Tambah Menu Baru</h2>
                <button class="close" aria-label="Tutup modal">&times;</button>
            </div>
            <form id="addMenuForm">
                <div class="form-group">
                    <label for="menuName">Nama Menu</label>
                    <input type="text" id="menuName" placeholder="Masukkan nama menu" required>
                </div>
                <div class="form-group">
                    <label for="menuCategory">Kategori</label>
                    <select id="menuCategory" required>
                        <option value="">Pilih Kategori</option>
                        <option value="makanan">Makanan</option>
                        <option value="minuman">Minuman</option>
                        <option value="tambahan">Tambahan</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="menuPrice">Harga</label>
                    <input type="number" id="menuPrice" placeholder="Masukkan harga" required>
                </div>
                <div class="form-group">
                    <label for="menuDescription">Deskripsi (Opsional)</label>
                    <textarea id="menuDescription" placeholder="Masukkan deskripsi menu" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label for="menuImage">Gambar Menu (URL)</label>
                    <input type="text" id="menuImage" placeholder="Masukkan URL gambar">
                </div>
                <button type="submit" class="btn" style="width: 100%;">Tambah Menu</button>
            </form>
        </div>
    </div>

    <!-- Edit Menu Modal -->
    <div id="editMenuModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Edit Menu</h2>
                <button class="close" aria-label="Tutup modal">&times;</button>
            </div>
            <form id="editMenuForm">
                <input type="hidden" id="editMenuId">
                <div class="form-group">
                    <label for="editMenuName">Nama Menu</label>
                    <input type="text" id="editMenuName" required>
                </div>
                <div class="form-group">
                    <label for="editMenuCategory">Kategori</label>
                    <select id="editMenuCategory" required>
                        <option value="makanan">Makanan</option>
                        <option value="minuman">Minuman</option>
                        <option value="tambahan">Tambahan</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="editMenuPrice">Harga</label>
                    <input type="number" id="editMenuPrice" required>
                </div>
                <div class="form-group">
                    <label for="editMenuImage">Gambar Menu (URL)</label>
                    <input type="text" id="editMenuImage">
                </div>
                <button type="submit" class="btn" style="width: 100%;">Simpan Perubahan</button>
            </form>
        </div>
    </div>

    <!-- Stock Modal -->
    <div id="stockModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="stockModalTitle">Input Stok</h2>
                <button class="close" aria-label="Tutup modal">&times;</button>
            </div>
            <form id="stockForm">
                <input type="hidden" id="stockType">
                <div class="form-group">
                    <label for="stockItem">Pilih Barang</label>
                    <select id="stockItem" required>
                        <option value="">-- Pilih Barang --</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="stockQuantity">Jumlah</label>
                    <input type="number" id="stockQuantity" min="1" required>
                </div>
                <div class="form-group">
                    <label for="stockReason">Keterangan</label>
                    <input type="text" id="stockReason" placeholder="Contoh: Belanja pasar, Barang rusak, dll" required>
                </div>
                <button type="submit" class="btn" style="width: 100%;">Simpan</button>
            </form>
        </div>
    </div>

    <!-- Receipt Modal -->
    <div id="receiptModal" class="modal">
        <div class="modal-content">
            <div class="receipt" id="receiptContent">
                <!-- Receipt content will be inserted here by JavaScript -->
            </div>
            <div class="cart-actions" style="margin-top: 20px; justify-content: center;">
                <button class="btn" id="printReceipt">Cetak Struk</button>
                <button class="btn btn-outline" id="newOrder">Pesanan Baru</button>
            </div>
        </div>
    </div>

    <!-- Shift Management Modal -->
    <div id="shiftModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="shiftModalTitle">Manajemen Shift</h2>
                <button class="close" aria-label="Tutup modal">&times;</button>
            </div>
            <form id="shiftForm">
                <div class="form-group">
                    <label>Kasir Bertugas</label>
                    <input type="text" id="shiftKasirName" readonly>
                </div>
                <div class="form-group">
                    <label for="shiftAmount">Saldo Kas (Awal/Akhir)</label>
                    <input type="number" id="shiftAmount" required>
                </div>
                <button type="submit" class="btn" id="shiftSubmitBtn" style="width: 100%;">Mulai Shift</button>
            </form>
        </div>
    </div>

    <!-- Dashboard -->
    <div class="dashboard" id="dashboard">
        <div class="dashboard-header">
            <div class="container dashboard-nav">
                <div class="logo">
                    <button class="sidebar-toggle" id="sidebarToggle" aria-label="Buka sidebar"><i class="fas fa-bars"></i></button>
                    <img src="soto.png" alt="Logo" style="height: 40px; width: 40px; object-fit: cover; border-radius: 50%; border: 2px solid white;">
                    <h1 id="dashboardTitle">Dashboard Soto Lamongan</h1>
                </div>
                <ul>
                    <li><span id="userRoleDisplay"></span></li>
                    <li><button id="shiftBtn" class="btn btn-small" style="background: rgba(255,255,255,0.2);">Shift: Tutup</button></li>
                    <li><a href="#" id="logoutBtn">Logout</a></li>
                </ul>
            </div>
        </div>
        <div class="dashboard-content">
            <div class="sidebar">
                <ul id="sidebarMenu">
                    <!-- Sidebar menu will be populated based on user role -->
                </ul>
            </div>
            <div class="main-content">
                <!-- Kasir Section -->
                <div class="dashboard-section active" id="kasir">
                    <h2>Kasir - Sistem Pemesanan</h2>
                    <div class="kasir-container">
                        <div class="menu-kasir">
                            <div class="search-container">
                                <input type="text" id="searchMenuKasir" class="search-input" placeholder="Cari menu...">
                            </div>
                            <div class="menu-categories-kasir">
                                <button class="category-btn-kasir active" data-category="all">Semua</button>
                                <button class="category-btn-kasir" data-category="makanan">Makanan</button>
                                <button class="category-btn-kasir" data-category="minuman">Minuman</button>
                                <button class="category-btn-kasir" data-category="tambahan">Tambahan</button>
                            </div>
                            <div class="menu-items-kasir" id="menuItemsKasir">
                                <!-- Menu items will be inserted here by JavaScript -->
                            </div>
                        </div>
                        <div class="keranjang-kasir">
                            <div class="keranjang-header">
                                <h3>Keranjang Pesanan</h3>
                                <button class="btn-kasir btn-kasir-outline" id="clearCartKasir">Kosongkan</button>
                            </div>
                            <div class="keranjang-items" id="keranjangItemsKasir">
                                <!-- Cart items will be inserted here -->
                            </div>
                            <!-- Payment & Discount Options -->
                            <div style="padding: 10px 0; border-top: 1px solid #eee;">
                                <div class="form-group" style="margin-bottom: 10px;">
                                    <label style="font-size: 12px;">Diskon (%)</label>
                                    <input type="number" id="cartDiscount" value="0" min="0" max="100" style="padding: 5px;">
                                </div>
                                <div class="form-group" style="margin-bottom: 10px;">
                                    <label style="font-size: 12px;">Metode Pembayaran</label>
                                    <select id="paymentMethod" style="padding: 5px;">
                                        <option value="Cash">Tunai</option>
                                        <option value="QRIS">QRIS</option>
                                        <option value="Transfer">Transfer Bank</option>
                                        <option value="E-Wallet">E-Wallet</option>
                                    </select>
                                </div>
                            </div>
                            <div class="keranjang-total">
                                <span>Total:</span>
                                <span id="keranjangTotalKasir">Rp 0</span>
                            </div>
                            <div class="keranjang-actions">
                                <button class="btn-kasir btn-kasir-primary" id="checkoutKasir"><i class="fas fa-credit-card"></i> Bayar Sekarang</button>
                                <button class="btn-kasir btn-kasir-secondary" id="saveOrderKasir">Simpan Pesanan</button>
                                <button class="btn-kasir btn-kasir-primary" id="showQRCode">Bayar dengan QR Code</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Overview Section -->
                <div class="dashboard-section" id="overview">
                    <h2>Overview Penjualan</h2>
                    <div class="stats-cards">
                        <div class="stat-card">
                            <h3>Pendapatan Hari Ini</h3>
                            <div class="value" id="overviewRevenueToday">Rp 0</div>
                        </div>
                        <div class="stat-card">
                            <h3>Total Pesanan (Hari Ini)</h3>
                            <div class="value" id="overviewTotalOrders">0</div>
                        </div>
                        <div class="stat-card">
                            <h3>Menu Terlaris</h3>
                            <div class="value" id="overviewBestSeller">-</div>
                        </div>
                        <div class="stat-card">
                            <h3>Rating Pelanggan</h3>
                            <div class="value" id="overviewRating">4.8/5</div>
                        </div>
                    </div>

                    <!-- Low Stock Notification Area -->
                    <div id="lowStockAlertArea" style="margin-bottom: 20px;">
                        <!-- Alerts will be injected here -->
                    </div>
                    
                    <div class="filter-container" style="margin-top: 20px;">
                        <label>Filter Grafik:</label>
                        <input type="date" id="chartStartDate">
                        <span>s/d</span>
                        <input type="date" id="chartEndDate">
                        <button class="btn btn-small" id="applyChartFilter">Terapkan</button>
                        <button class="btn btn-small btn-outline" id="resetChartFilter">Reset</button>
                    </div>
                    <h3 id="chartTitle">Grafik Penjualan 7 Hari Terakhir</h3>
                    <div style="background-color: #f9f9f9; padding: 20px; border-radius: 10px; margin-top: 20px;">
                        <canvas id="salesChart"></canvas>
                    </div>
                </div>


                <!-- Kelola Menu Section -->
                <div class="dashboard-section" id="menu-management">
                    <h2>Kelola Menu</h2>
                    <button class="btn btn-small" style="margin-bottom: 20px;" id="addMenuBtn">Tambah Menu Baru</button>
                    <div class="table-wrapper">
                        <table>
                            <thead>
                                <tr>
                                    <th>No</th>
                                    <th>Nama Menu</th>
                                    <th>Kategori</th>
                                    <th>Harga</th>
                                    <th>Status</th>
                                    <th>Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="menuTableBody">
                                <!-- Menu items will be inserted here by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Inventory Management Section -->
                <div class="dashboard-section" id="inventory-management">
                    <h2>Kelola Stok Barang</h2>
                    <div style="display: flex; gap: 10px; margin-bottom: 20px;">
                        <button class="btn btn-small" id="btnStockIn" style="background-color: #2a9d8f;"><i class="fas fa-plus"></i> Input Barang Masuk</button>
                        <button class="btn btn-small btn-danger" id="btnStockOut"><i class="fas fa-minus"></i> Input Barang Keluar (Manual)</button>
                    </div>
                    
                    <div class="table-wrapper">
                        <h3>Stok Saat Ini</h3>
                        <table>
                            <thead>
                                <tr>
                                    <th>No</th>
                                    <th>Nama Barang</th>
                                    <th>Kategori</th>
                                    <th>Stok</th>
                                    <th>Status</th>
                                    <th>Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="inventoryTableBody">
                                <!-- Inventory items -->
                            </tbody>
                        </table>
                    </div>

                    <div class="table-wrapper" style="margin-top: 30px;">
                        <h3>Riwayat Perubahan Stok (Terbaru)</h3>
                        <table>
                            <thead>
                                <tr>
                                    <th>Waktu</th>
                                    <th>Barang</th>
                                    <th>Tipe</th>
                                    <th>Jumlah</th>
                                    <th>Keterangan</th>
                                </tr>
                            </thead>
                            <tbody id="stockHistoryTableBody">
                                <!-- History items -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Data Penjualan Section -->
                <div class="dashboard-section" id="penjualan">
                    <h2>Data Penjualan</h2>
                    <button class="btn btn-small btn-danger" style="margin-bottom: 20px;" id="resetSalesBtn">Hapus & Mulai Ulang Penjualan</button>
                    <div class="filter-container">
                        <label>Filter Tanggal:</label>
                        <input type="date" id="salesFilterDate">
                        <button class="btn btn-small" id="applySalesFilter">Terapkan</button>
                        <button class="btn btn-small btn-outline" id="clearSalesFilter">Reset</button>
                    </div>
                    <div class="table-wrapper">
                        <table>
                            <thead>
                                <tr>
                                    <th>No</th>
                                    <th>ID Pesanan</th>
                                    <th>Tanggal</th>
                                    <th>Kasir</th>
                                    <th>Total</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody id="salesTableBody">
                                <!-- Sales data will be inserted here by JavaScript -->
                            </tbody>
                        </table>
                        <!-- Pagination Controls -->
                        <div class="pagination-controls" id="salesPagination">
                            <button class="btn btn-small btn-outline" id="prevPageBtn" disabled>Sebelumnya</button>
                            <span id="pageIndicator" style="align-self: center;">Halaman 1</span>
                            <button class="btn btn-small btn-outline" id="nextPageBtn">Selanjutnya</button>
                        </div>
                    </div>
                </div>

                <!-- Order Management Section -->
                <div class="dashboard-section" id="order-management">
                    <h2>Kelola Pesanan</h2>
                    <div class="form-group" style="background-color: #f9f9f9; padding: 20px; border-radius: 10px; margin-bottom: 30px;">
                        <h3 style="margin-bottom: 15px;">Tambah Pesanan Baru</h3>
                        <form id="addOrderForm">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="orderCustomerName">Nama Pemesan</label>
                                    <input type="text" id="orderCustomerName" placeholder="Masukkan nama pemesan" required>
                                </div>
                                <div class="form-group">
                                    <label for="orderMenu">Menu</label>
                                    <select id="orderMenu" required>
                                        <option value="">Pilih Menu</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="orderQuantity">Jumlah</label>
                                    <input type="number" id="orderQuantity" value="1" min="1" required>
                                </div>
                                <div class="form-group">
                                    <label>Harga Satuan</label>
                                    <input type="text" id="orderPrice" readonly value="Rp 0">
                                </div>
                            </div>
                            <p><strong>Total Harga: <span id="orderTotal">Rp 0</span></strong></p>
                            <button type="submit" class="btn" style="margin-top: 15px;">Tambah Pesanan</button>
                        </form>
                    </div>
                    <h3>Daftar Pesanan Masuk</h3>
                    <div class="table-wrapper">
                        <table>
                            <thead>
                                <tr>
                                    <th>ID Pesanan</th>
                                    <th>Nama Pemesan</th>
                                    <th>Menu</th>
                                    <th>Jumlah</th>
                                    <th>Harga Satuan</th>
                                    <th>Total Harga</th>
                                    <th>Waktu Pesan</th>
                                    <th>Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="orderTableBody">
                                <!-- Order items will be inserted here by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- User Management Section -->
                <div class="dashboard-section" id="user-management">
                    <h2>Kelola Pengguna</h2>
                    <button class="btn btn-small" style="margin-bottom: 20px;" id="addUserBtn">Tambah Pengguna Baru</button>
                    <div class="table-wrapper">
                        <table>
                            <thead>
                                <tr>
                                    <th>No</th>
                                    <th>Username</th>
                                    <th>Email</th>
                                    <th>Role</th>
                                    <th>Status</th>
                                    <th>Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="userTableBody">
                                <!-- User items will be inserted here by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- Activity Log Section -->
                    <h3 style="margin-top: 30px;">Activity Log (Riwayat Aktivitas)</h3>
                    <div class="table-wrapper" style="max-height: 300px; overflow-y: auto; background: white; border: 1px solid #eee; border-radius: 5px;">
                        <div id="activityLogContainer">
                            <!-- Logs go here -->
                            <p style="padding: 10px; color: #777;">Belum ada aktivitas tercatat.</p>
                        </div>
                    </div>
                </div>

                <!-- Laporan Section -->
                <div class="dashboard-section" id="laporan">
                    <h2>Laporan Penjualan</h2>
                    <div class="form-group">
                        <label>Pilih Periode Laporan</label>
                        <div style="display: flex; gap: 10px; align-items: center;">
                            <input type="date" id="reportStartDate" style="flex: 1;">
                            <span style="line-height: 40px;">s/d</span>
                            <input type="date" id="reportEndDate" style="flex: 1;">
                            <button class="btn btn-small" id="generateReportBtn">Generate Laporan</button>
                            <button class="btn btn-small btn-success" id="exportExcelBtn"><i class="fas fa-file-excel"></i> Export Excel</button>
                            <button class="btn btn-small btn-danger" id="exportPdfBtn"><i class="fas fa-file-pdf"></i> Export PDF</button>
                        </div>
                    </div>

                    <div id="reportResult" style="background-color: #f9f9f9; padding: 20px; border-radius: 10px; margin-top: 20px; display: none;">
                        <!-- Konten laporan akan dibuat di sini oleh JavaScript -->
                    </div>
                </div>

                <!-- Pengaturan Section -->
                <div class="dashboard-section" id="pengaturan">
                    <h2>Pengaturan Sistem</h2>
                    <div class="form-group">
                        <label>Nama Warung</label>
                        <input type="text" value="Warung Soto Cak Har">
                    </div>
                    <div class="form-group">
                        <label>Alamat</label>
                        <input type="text" value="Jl. Merdeka No. 14, Pusat Kota, Lamongan, Jawa Timur">
                    </div>
                    <div class="form-group">
                        <label>Telepon</label>
                        <input type="text" value="0812-3456-7890">
                    </div>
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" value="kontak@sotocakhar.com">
                    </div>
                    <hr style="margin: 20px 0; border: 0; border-top: 1px solid #eee;">
                    <h3>Manajemen Data</h3>
                    <div class="form-group" style="margin-top: 15px;">
                        <button class="btn btn-small" id="backupDataBtn" style="background-color: #2a9d8f;"><i class="fas fa-download"></i> Backup Data (JSON)</button>
                        <button class="btn btn-small" onclick="document.getElementById('restoreDataInput').click()" style="background-color: #e9c46a; color: #333;"><i class="fas fa-upload"></i> Restore Data</button>
                        <input type="file" id="restoreDataInput" style="display: none;" accept=".json">
                    </div>
                    <button class="btn">Simpan Pengaturan</button>
                </div>
            </div>
        </div>
    </div>

    <!-- QR Code Modal -->
    <div id="qrCodeModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Bayar dengan QR Code</h2>
                <button class="close" aria-label="Tutup modal">&times;</button>
            </div>
            <div style="text-align: center;">
                <p>Scan QR Code berikut untuk melakukan pembayaran:</p>                
                <div id="qrCodeContainer" style="width: 200px; margin: 0 auto 20px;">
                    <!-- QR Code akan ditampilkan di sini -->
                </div>
                <p>Setelah pembayaran selesai, mohon tunggu konfirmasi.</p>
                <button class="btn" id="confirmPayment">Konfirmasi Pembayaran</button>
            </div>
        </div>
    </div>

    <!-- Lightbox Modal -->
    <div id="lightboxModal" class="lightbox-modal">
        <button class="close" style="position: absolute; top: 20px; right: 30px; font-size: 40px; color: white;" aria-label="Tutup lightbox">&times;</button>
        <div class="modal-content" style="background: none; box-shadow: none; max-width: 90vw; max-height: 90vh;">
            <img src="" id="lightboxImage" alt="Tampilan Gambar" style="width: 100%; height: auto; max-height: 90vh; border-radius: 5px;">
        </div>
    </div>

    <!-- Back to Top Button -->
    <div id="backToTopBtn" class="back-to-top-btn" title="Kembali ke atas">
        <i class="fas fa-arrow-up"></i>
    </div>

    <!-- PWA Install Button -->
    <button id="pwaInstallBtn" class="btn btn-small">
        <i class="fas fa-download"></i> Install App
    </button>
    
    <!-- Loading Overlay -->
    <div id="loading-overlay">
        <div class="spinner"></div>
    </div>

    <script>
        // =================================================================================
        // HELPER FUNCTIONS (Efficient Code & Utils)
        // =================================================================================
        function qs(selector, parent = document) {
            return parent.querySelector(selector);
        }

        function qsa(selector, parent = document) {
            return Array.from(parent.querySelectorAll(selector));
        }

        function validateEmail(email) {
            return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
        }

        function showLoading() {
            const overlay = document.getElementById('loading-overlay');
            if(overlay) overlay.style.display = 'flex';
        }

        function hideLoading() {
            const overlay = document.getElementById('loading-overlay');
            if(overlay) overlay.style.display = 'none';
        }

        function paginateData(data, page, itemsPerPage) {
            const start = (page - 1) * itemsPerPage;
            return data.slice(start, start + itemsPerPage);
        }

        // AES Encryption Helpers
        const SECRET_KEY = "SotoLamonganSecretKey123"; // In production, use env variable
        function encryptData(data) {
            return CryptoJS.AES.encrypt(JSON.stringify(data), SECRET_KEY).toString();
        }
        function decryptData(ciphertext) {
            try {
                const bytes = CryptoJS.AES.decrypt(ciphertext, SECRET_KEY);
                return JSON.parse(bytes.toString(CryptoJS.enc.Utf8));
            } catch (e) { return null; }
        }

        // Service Worker Registration (PWA)
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js').catch(err => console.error('SW reg fail:', err));
            });
        }

        // =================================================================================
        // DATA AND STATE MANAGEMENT
        // =================================================================================
        // Data and State Management
        let cartKasir = [];
        let currentUserRole = 'kasir';
        let salesChart = null;
        let menuItems = [
            { id: 1, name: "Soto Ayam Lamongan", category: "makanan", price: 25000, status: "active", image: null, stock: 50 },
            { id: 2, name: "Soto Daging Lamongan", category: "makanan", price: 30000, status: "active", image: null, stock: 40 },
            { id: 3, name: "Nasi Goreng Lamongan", category: "makanan", price: 20000, status: "active", image: null, stock: 30 },
            { id: 4, name: "Es Jeruk", category: "minuman", price: 8000, status: "active", image: null, stock: 100 },
            { id: 5, name: "Teh Manis", category: "minuman", price: 5000, status: "active", image: null, stock: 100 },
            { id: 6, name: "Kerupuk Udang", category: "tambahan", price: 3000, status: "active", image: null, stock: 200 },
            { id: 7, name: "Telur Rebus", category: "tambahan", price: 5000, status: "active", image: null, stock: 150 },
            { id: 8, name: "Emping Melinjo", category: "tambahan", price: 4000, status: "active", image: null, stock: 100 }
        ];

        // Sales data (will be populated automatically)
        let salesData = [];
        let orderNumber = 1;
        
        // Pagination State for Sales
        let currentSalesPage = 1;
        const itemsPerPage = 10;

        // Pending orders data
        let pendingOrders = [];
        
        // Stock History Data
        let stockHistory = [];
        
        // Activity Log Data
        let activityLog = JSON.parse(localStorage.getItem('sotoLamonganActivityLog')) || [];

        // Shift Data
        let currentShift = JSON.parse(localStorage.getItem('sotoLamonganCurrentShift')) || null;

        // User data (in a real app, this would be stored in a database)
        // Load from localStorage if available, otherwise use default
        let users = [];
        const storedUsers = localStorage.getItem('sotoLamonganUsers');
        
        if (storedUsers) {
            // Try decrypting first, if fail assume plain text (migration)
            const decrypted = decryptData(storedUsers);
            users = decrypted ? decrypted : JSON.parse(storedUsers);
        }

        // Initialize Default Users if empty
        if (users.length === 0) {
            // Hashes for 'admin123' and 'kasir123'
            const adminHash = "240be518fabd2724ddb6f04eeb1da5967448d7e831c08c8fa822809f74c720a9"; 
            const kasirHash = "859505354559f54258d70631317e67323561250d27924372054e9ad4d9154bf2";
            
            users = [
                { username: 'admin', password: adminHash, email: 'admin@soto.com', role: 'admin', status: 'active' },
                { username: 'kasir', password: kasirHash, email: 'kasir@soto.com', role: 'kasir', status: 'active' }
            ];
            localStorage.setItem('sotoLamonganUsers', JSON.stringify(users));
        }

        function saveUsersToLocalStorage() {
            // Encrypt before saving
            const encrypted = encryptData(users);
            localStorage.setItem('sotoLamonganUsers', encrypted);
        }

        // =================================================================================
        // LOGGING & SESSION
        // =================================================================================
        function logActivity(action) {
            const log = {
                timestamp: new Date().toISOString(),
                user: currentUserRole === 'admin' ? (users.find(u => u.role === 'admin')?.username || 'Admin') : 'Kasir',
                action: action
            };
            activityLog.unshift(log); // Add to beginning
            if (activityLog.length > 100) activityLog.pop(); // Keep last 100
            localStorage.setItem('sotoLamonganActivityLog', JSON.stringify(activityLog));
            updateActivityLogDisplay();
        }

        let sessionTimer;
        function resetSessionTimer() {
            clearTimeout(sessionTimer);
            if (document.getElementById('dashboard').style.display === 'block' && currentUserRole) {
                // Auto logout after 15 minutes of inactivity
                sessionTimer = setTimeout(() => {
                    Swal.fire('Session Timeout', 'Sesi Anda telah berakhir karena tidak ada aktivitas.', 'warning')
                    .then(() => {
                        logActivity('Session Timeout');
                        document.getElementById('logoutBtn').click();
                    });
                }, 15 * 60 * 1000); 
            }
        }
        // Attach to common events
        ['click', 'mousemove', 'keypress'].forEach(evt => document.addEventListener(evt, resetSessionTimer));

        // =================================================================================
        // SECURITY & UTILS
        // =================================================================================
        
        // Input Sanitization to prevent XSS
        function escapeHtml(text) {
            if (!text) return text;
            if (typeof text !== 'string') return text;
            return text
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;")
                .replace(/'/g, "&#039;");
        }

        // Simple Password Hashing (SHA-256)
        async function hashPassword(string) {
            const msgBuffer = new TextEncoder().encode(string);
            const hashBuffer = await crypto.subtle.digest('SHA-256', msgBuffer);
            const hashArray = Array.from(new Uint8Array(hashBuffer));
            return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
        }

        // =================================================================================
        // DOM ELEMENT SELECTION
        // =================================================================================
        // DOM Elements
        const loginBtn = document.getElementById('loginBtn');
        const loginModal = document.getElementById('loginModal');
        const loginForm = document.getElementById('loginForm');
        const forgotPasswordModal = document.getElementById('forgotPasswordModal');
        const forgotPasswordForm = document.getElementById('forgotPasswordForm');
        const resetPasswordModal = document.getElementById('resetPasswordModal');
        const resetPasswordForm = document.getElementById('resetPasswordForm');
        const createAccountModal = document.getElementById('createAccountModal');
        const createAccountForm = document.getElementById('createAccountForm');
        const addMenuModal = document.getElementById('addMenuModal');
        const addMenuForm = document.getElementById('addMenuForm');
        const editMenuModal = document.getElementById('editMenuModal');
        const editMenuForm = document.getElementById('editMenuForm');
        const dashboard = document.getElementById('dashboard');
        const logoutBtn = document.getElementById('logoutBtn');
        const closeButtons = document.querySelectorAll('.close');
        const receiptModal = document.getElementById('receiptModal');
        const receiptContent = document.getElementById('receiptContent');
        const printReceiptBtn = document.getElementById('printReceipt');
        const newOrderBtn = document.getElementById('newOrder');

        // Kasir Elements
        const menuItemsKasir = document.getElementById('menuItemsKasir');
        const keranjangItemsKasir = document.getElementById('keranjangItemsKasir');
        const keranjangTotalKasir = document.getElementById('keranjangTotalKasir');
        const clearCartKasirBtn = document.getElementById('clearCartKasir');
        const checkoutKasirBtn = document.getElementById('checkoutKasir');
        const saveOrderKasirBtn = document.getElementById('saveOrderKasir');
        const cartDiscountInput = document.getElementById('cartDiscount');
        const paymentMethodSelect = document.getElementById('paymentMethod');
        const categoryButtonsKasir = document.querySelectorAll('.category-btn-kasir');
        const searchMenuKasirInput = document.getElementById('searchMenuKasir');
        const showQRCodeBtn = document.getElementById('showQRCode');
        const qrCodeModal = document.getElementById('qrCodeModal');
        const menuTableBody = document.getElementById('menuTableBody');
        const addMenuBtn = document.getElementById('addMenuBtn');
        const userTableBody = document.getElementById('userTableBody');
        const addUserBtn = document.getElementById('addUserBtn');
        const salesTableBody = document.getElementById('salesTableBody');
        
        // Sales Filter
        const salesFilterDate = document.getElementById('salesFilterDate');

        // Inventory Elements
        const inventoryTableBody = document.getElementById('inventoryTableBody');
        const stockHistoryTableBody = document.getElementById('stockHistoryTableBody');
        const stockModal = document.getElementById('stockModal');
        const stockForm = document.getElementById('stockForm');

        // Order Management Elements
        const addOrderForm = document.getElementById('addOrderForm');
        const orderMenuSelect = document.getElementById('orderMenu');
        const orderQuantityInput = document.getElementById('orderQuantity');
        const orderPriceDisplay = document.getElementById('orderPrice');
        const orderTotalDisplay = document.getElementById('orderTotal');
        const orderTableBody = document.getElementById('orderTableBody');

        // Overview elements
        const overviewRevenueToday = document.getElementById('overviewRevenueToday');
        const overviewTotalOrders = document.getElementById('overviewTotalOrders');
        const overviewBestSeller = document.getElementById('overviewBestSeller');
        const overviewRating = document.getElementById('overviewRating');
        const sidebarToggle = document.getElementById('sidebarToggle');

        // Report elements
        const generateReportBtn = document.getElementById('generateReportBtn');
        const exportExcelBtn = document.getElementById('exportExcelBtn');
        const exportPdfBtn = document.getElementById('exportPdfBtn');
        const reportResultDiv = document.getElementById('reportResult');


        // User role elements
        const userRoleSelectors = document.querySelectorAll('.user-role-selector .user-role');
        const dashboardTitle = document.getElementById('dashboardTitle');
        const userRoleDisplay = document.getElementById('userRoleDisplay');
        const sidebarMenu = document.getElementById('sidebarMenu');

        // Modal navigation elements
        const forgotPasswordLink = document.getElementById('forgotPasswordLink');
        const createAccountLink = document.getElementById('createAccountLink');
        const backToLoginFromForgot = document.getElementById('backToLoginFromForgot');
        const backToLoginFromCreate = document.getElementById('backToLoginFromCreate');

        // Shift Elements
        const shiftBtn = document.getElementById('shiftBtn');
        const shiftModal = document.getElementById('shiftModal');
        const shiftForm = document.getElementById('shiftForm');
        const shiftModalTitle = document.getElementById('shiftModalTitle');

        // =================================================================================
        // MAIN EVENT LISTENERS
        // =================================================================================
        // Event Listeners
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize user role selectors
            initializeUserRoleSelectors();

            // Check for persistent login
            const storedUserJSON = localStorage.getItem('sotoLamonganCurrentUser');
            if (storedUserJSON) {
                try {
                    const storedUser = JSON.parse(storedUserJSON);
                    // Validate against current users list
                    const validUser = users.find(u => u.username === storedUser.username && u.status === 'active');
                    
                    if (validUser) {
                        currentUserRole = validUser.role;
                        
                        // Hide landing page
                        document.querySelector('header').style.display = 'none';
                        document.querySelectorAll('section').forEach(sec => sec.style.display = 'none');
                        document.querySelector('footer').style.display = 'none';

                        // Show dashboard
                        dashboard.style.display = 'block';
                        updateDashboardForUserRole();
                        logActivity('Session Restored');
                        resetSessionTimer();
                        checkLowStock();
                    } else {
                        localStorage.removeItem('sotoLamonganCurrentUser');
                    }
                } catch (e) { localStorage.removeItem('sotoLamonganCurrentUser'); }
            }

            // Initialize main navigation hamburger menu
            const navToggle = document.getElementById('navToggle');
            const mainNavMenu = document.getElementById('mainNavMenu');
            navToggle.addEventListener('click', () => {
                mainNavMenu.classList.toggle('active');
            });

            // Initialize kasir
            initializeKasir();

            // Initialize Settings (Backup/Restore)
            document.getElementById('backupDataBtn').addEventListener('click', backupData);
            document.getElementById('restoreDataInput').addEventListener('change', restoreData);

            // Initialize dashboard sidebar toggle
            sidebarToggle.addEventListener('click', () => {
                document.querySelector('.sidebar').classList.toggle('open');
            });

            // Initialize report generator
            generateReportBtn.addEventListener('click', generateSalesReport);
            exportExcelBtn.addEventListener('click', exportToExcel);
            exportPdfBtn.addEventListener('click', exportToPdf);

            // Initialize Sales Filter
            document.getElementById('applySalesFilter').addEventListener('click', () => updateSalesTable(true));
            document.getElementById('clearSalesFilter').addEventListener('click', () => { document.getElementById('salesFilterDate').value = ''; updateSalesTable(false); });
            
            // Initialize Sales Pagination
            document.getElementById('prevPageBtn').addEventListener('click', () => changeSalesPage(-1));
            document.getElementById('nextPageBtn').addEventListener('click', () => changeSalesPage(1));

            
            // Initialize Chart Filter
            document.getElementById('applyChartFilter').addEventListener('click', () => {
                const start = document.getElementById('chartStartDate').value;
                const end = document.getElementById('chartEndDate').value;
                initializeSalesChart(start, end);
            });
            document.getElementById('resetChartFilter').addEventListener('click', () => {
                document.getElementById('chartStartDate').value = '';
                document.getElementById('chartEndDate').value = '';
                initializeSalesChart();
            });

            // Initialize Order Management
            initializeOrderManagement();
            
            // Initialize Inventory Management
            initializeInventory();

            // Initialize Shift Management
            initializeShiftManagement();


            // Modal close buttons
            closeButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const modal = this.closest('.modal');
                    modal.style.display = 'none';
                });
            });

            // Close modal when clicking outside
            window.addEventListener('click', function(e) {
                if (e.target.classList.contains('modal')) {
                    e.target.style.display = 'none';
                }
            });

            // Login functionality
            loginBtn.addEventListener('click', async function(e) {
                e.preventDefault();
                if (users.length === 0) {
                    Swal.fire({
                        title: 'Selamat Datang',
                        text: 'Belum ada akun terdaftar. Silakan buat akun baru untuk memulai.',
                        icon: 'info',
                        confirmButtonText: 'Buat Akun'
                    }).then(() => {
                        createAccountModal.style.display = 'flex';
                    });
                } else {
                    loginModal.style.display = 'flex';
                }
            });

            loginForm.addEventListener('submit', async function(e) {
                e.preventDefault();
                
                // Security: Login Throttling
                let attempts = parseInt(localStorage.getItem('loginAttempts') || 0);
                let lockTime = parseInt(localStorage.getItem('loginLockTime') || 0);
                
                if (lockTime && Date.now() < lockTime) {
                    const remaining = Math.ceil((lockTime - Date.now()) / 60000);
                    Swal.fire('Akun Terkunci', `Terlalu banyak percobaan gagal. Coba lagi dalam ${remaining} menit.`, 'error');
                    return;
                }

                const username = document.getElementById('username').value;
                const password = document.getElementById('password').value;
                const selectedRole = document.querySelector('#loginModal .user-role.active').getAttribute('data-role');

                // Hash input password for comparison
                const hashedPassword = await hashPassword(password);

                let user = users.find(u => u.username === username);
                let canLogin = false;

                if (user) {
                    // Check password (support both legacy plain text and new hash)
                    // If stored password length is 64 (SHA-256 hex), compare with hash, else compare plain
                    const isMatch = (user.password.length === 64) ? (user.password === hashedPassword) : (user.password === password);

                    if (isMatch && user.status === 'active') {
                        // Periksa apakah role yang dipilih sesuai dengan role user
                        if (user.role === selectedRole) {
                            canLogin = true;
                        } else {
                            Swal.fire('Role Salah', `Akun ini terdaftar sebagai ${user.role}, silakan pilih role yang sesuai.`, 'warning');
                            return;
                        }
                    }
                }

                if (canLogin) {
                    // Hide main website and show dashboard
                    document.querySelector('header').style.display = 'none';
                    document.querySelectorAll('section').forEach(sec => sec.style.display = 'none');
                    document.querySelector('footer').style.display = 'none';

                    // Set current user role and update dashboard
                    currentUserRole = user.role;
                    
                    // Save session
                    localStorage.setItem('sotoLamonganCurrentUser', JSON.stringify({
                        username: user.username,
                        role: user.role
                    }));

                    updateDashboardForUserRole();
                    
                    // Reset attempts on success
                    localStorage.setItem('loginAttempts', 0);
                    localStorage.removeItem('loginLockTime');

                    // Show dashboard
                    dashboard.style.display = 'block';
                    loginModal.style.display = 'none';

                    // Clear login form
                    loginForm.reset();
                    
                    logActivity('User Login');
                    resetSessionTimer();
                    checkLowStock(); // Check stock on login
                } else {
                    Swal.fire({
                        icon: 'error',
                        title: 'Login Gagal',
                        text: 'Username atau password salah!',
                    });
                }
            });

            // Forgot password functionality
            forgotPasswordLink.addEventListener('click', function(e) {
                e.preventDefault();
                loginModal.style.display = 'none';
                forgotPasswordModal.style.display = 'flex';
            });

            backToLoginFromForgot.addEventListener('click', function(e) {
                e.preventDefault();
                forgotPasswordModal.style.display = 'none';
                loginModal.style.display = 'flex';
            });

            forgotPasswordForm.addEventListener('submit', function(e) {
                e.preventDefault();
                const username = document.getElementById('forgotUsername').value;
                const email = document.getElementById('forgotEmail').value;

                // Check if user exists
                const user = users.find(u => u.username === username && u.email === email);

                if (user) {
                    // Hide forgot password modal and show reset password modal
                    forgotPasswordModal.style.display = 'none';
                    document.getElementById('resetUsername').value = username; // Store username
                    resetPasswordModal.style.display = 'flex';
                    forgotPasswordForm.reset();
                } else {
                    Swal.fire({
                        icon: 'error',
                        title: 'Gagal',
                        text: 'Username atau email tidak ditemukan.',
                    });
                }
            });

            // Reset password functionality
            resetPasswordForm.addEventListener('submit', async function(e) {
                e.preventDefault();
                const username = document.getElementById('resetUsername').value;
                const newPassword = document.getElementById('resetNewPassword').value;
                const confirmPassword = document.getElementById('resetConfirmPassword').value;

                if (newPassword !== confirmPassword) {
                    Swal.fire('Gagal', 'Password baru dan konfirmasi tidak cocok.', 'warning');
                    return;
                }

                const user = users.find(u => u.username === username);
                if (user) {
                    // Save hashed password
                    user.password = await hashPassword(newPassword);
                    saveUsersToLocalStorage();
                    Swal.fire({
                        icon: 'success',
                        title: 'Berhasil!',
                        text: 'Password Anda telah berhasil diganti. Silakan login kembali.',
                    });
                    resetPasswordModal.style.display = 'none';
                    loginModal.style.display = 'flex';
                    resetPasswordForm.reset();
                } else {
                    Swal.fire('Error', 'Terjadi kesalahan. Pengguna tidak ditemukan.', 'error');
                    resetPasswordModal.style.display = 'none';
                    loginModal.style.display = 'flex';
                }
            });

            // Create account modal navigation
            createAccountLink.addEventListener('click', function(e) {
                e.preventDefault();
                loginModal.style.display = 'none';
                createAccountModal.style.display = 'flex';
            });

            backToLoginFromCreate.addEventListener('click', function(e) {
                e.preventDefault();
                createAccountModal.style.display = 'none';
                loginModal.style.display = 'flex';
            });

            // Create account form submission
            createAccountForm.addEventListener('submit', async function(e) {
                e.preventDefault();
                const username = document.getElementById('newUsername').value;
                const email = document.getElementById('newEmail').value;
                const password = document.getElementById('newPassword').value;
                const confirmPassword = document.getElementById('confirmPassword').value;

                // Strict Validation
                if (!validateEmail(email)) {
                    Swal.fire('Format Salah', 'Mohon masukkan alamat email yang valid.', 'warning');
                    return;
                }
                
                // Ambil role langsung dari elemen yang aktif di modal create account untuk akurasi
                const selectedRole = document.querySelector('#createAccountModal .user-role.active').getAttribute('data-role');

                // Check if passwords match
                if (password !== confirmPassword) {
                    Swal.fire({
                        icon: 'warning',
                        title: 'Oops...',
                        text: 'Password dan konfirmasi password tidak cocok!',
                    });
                    return;
                }

                // Check if username already exists
                if (users.find(u => u.username === username)) {
                    Swal.fire({
                        icon: 'warning',
                        title: 'Username Tidak Tersedia',
                        text: 'Username sudah digunakan. Silakan pilih username lain.',
                    });
                    return;
                }

                const hashedPassword = await hashPassword(password);

                // Add new user
                users.push({
                    username: escapeHtml(username),
                    password: hashedPassword,
                    email: email,
                    role: selectedRole,
                    status: 'active'
                });
                saveUsersToLocalStorage();
                logActivity(`New User Created: ${username}`);

                Swal.fire({
                    icon: 'success',
                    title: 'Berhasil!',
                    text: 'Akun berhasil dibuat! Silakan login.',
                });
                createAccountModal.style.display = 'none';
                loginModal.style.display = 'flex';
                createAccountForm.reset();
            });

            // Logout functionality
            logoutBtn.addEventListener('click', function(e) {
                e.preventDefault();

                // Clear session
                localStorage.removeItem('sotoLamonganCurrentUser');

                // Show main website and hide dashboard
                document.querySelector('header').style.display = '';
                document.querySelectorAll('section').forEach(sec => sec.style.display = '');
                // Restore hero display to flex
                document.querySelector('.hero').style.display = 'flex';
                document.querySelector('footer').style.display = '';

                // Hide dashboard
                dashboard.style.display = 'none';

                // Reset user role
                currentUserRole = 'kasir';
                clearTimeout(sessionTimer);
            });

            // Receipt buttons
            printReceiptBtn.addEventListener('click', printReceipt);
            newOrderBtn.addEventListener('click', startNewOrder);

            // Animate on scroll
            const observer = new IntersectionObserver((entries, observer) => {
                entries.forEach(entry => {
                    // Jika elemen terlihat di layar
                    if (entry.isIntersecting) {
                        // Tambahkan kelas animasi
                        entry.target.classList.add('animate__animated', 'animate__fadeInUp', 'animate__slow');
                        // Hentikan pengamatan pada elemen ini agar animasi tidak berulang
                        observer.unobserve(entry.target);
                    }
                });
            }, {
                threshold: 0.15 // Animasi akan terpicu saat 15% elemen terlihat
            });

            // Amati setiap elemen konten yang ingin dianimasikan
            document.querySelectorAll('.about-content, .location-content, .testimonials').forEach(el => {
                observer.observe(el);
            });

            // Lightbox Gallery Logic
            const galleryItems = document.querySelectorAll('.gallery-item');
            const lightboxModal = document.getElementById('lightboxModal');
            const lightboxImage = document.getElementById('lightboxImage');
            const lightboxClose = lightboxModal.querySelector('.close');

            galleryItems.forEach(item => {
                item.addEventListener('click', () => {
                    const imgSrc = item.querySelector('img').src;
                    lightboxImage.src = imgSrc;
                    lightboxModal.style.display = 'flex';
                });
            });

            function closeLightbox() {
                lightboxModal.style.display = 'none';
                lightboxImage.src = ''; // Kosongkan ja untuk menghentikan loading jika ada
            }

            lightboxClose.addEventListener('click', closeLightbox);
            lightboxModal.addEventListener('click', (e) => {
                if (e.target === lightboxModal) closeLightbox();
            });

            // Back to Top Button Logic
            const backToTopBtn = document.getElementById('backToTopBtn');

            window.addEventListener('scroll', () => {
                // Tampilkan tombol jika scroll lebih dari 300px
                if (window.scrollY > 300) {
                    backToTopBtn.classList.add('show');
                } else {
                    backToTopBtn.classList.remove('show');
                }
            });

            backToTopBtn.addEventListener('click', () => {
                // Gulir ke atas dengan halus
                window.scrollTo({
                    top: 0,
                    behavior: 'smooth'
                });
            });

            // PWA Install Prompt
            let deferredPrompt;
            const pwaBtn = document.getElementById('pwaInstallBtn');
            
            window.addEventListener('beforeinstallprompt', (e) => {
                e.preventDefault();
                deferredPrompt = e;
                pwaBtn.style.display = 'block';
            });

            pwaBtn.addEventListener('click', async () => {
                if (deferredPrompt) {
                    deferredPrompt.prompt();
                    const { outcome } = await deferredPrompt.userChoice;
                    if (outcome === 'accepted') {
                        pwaBtn.style.display = 'none';
                    }
                    deferredPrompt = null;
                }
            });
        });

        // =================================================================================
        // USER ROLE AND DASHBOARD UI FUNCTIONS
        // =================================================================================
        // User Role Functions
        function initializeUserRoleSelectors() {
            userRoleSelectors.forEach(selector => {
                selector.addEventListener('click', function() {
                    // Remove active class from all roles in this selector
                    const siblings = Array.from(this.parentElement.children);
                    siblings.forEach(sibling => sibling.classList.remove('active'));

                    // Add active class to clicked role
                    this.classList.add('active');

                    // Update current user role
                    currentUserRole = this.getAttribute('data-role');
                });
            });
        }

        function updateDashboardForUserRole() {
            // Update dashboard title and user role display
            dashboardTitle.textContent = `Dashboard Soto Lamongan - ${currentUserRole.toUpperCase()}`;
            userRoleDisplay.textContent = `Role: ${currentUserRole}`;

            // Update sidebar menu based on user role
            updateSidebarMenu();

            // Show appropriate default section
            const defaultSection = currentUserRole === 'admin' ? 'overview' : 'kasir';
            showDashboardSection(defaultSection);
        }

        function updateSidebarMenu() {
            sidebarMenu.innerHTML = '';

            if (currentUserRole === 'admin') {
                // Admin menu
                sidebarMenu.innerHTML = `
                    <li class="active"><a href="#" data-section="overview"><i class="fas fa-chart-line"></i> Overview</a></li>
                    <li><a href="#" data-section="kasir"><i class="fas fa-cash-register"></i> Kasir</a></li>
                    <li><a href="#" data-section="order-management"><i class="fas fa-clipboard-list"></i> Kelola Pesanan</a></li>
                    <li><a href="#" data-section="menu-management"><i class="fas fa-utensils"></i> Kelola Menu</a></li>
                    <li><a href="#" data-section="inventory-management"><i class="fas fa-boxes"></i> Kelola Stok</a></li>
                    <li><a href="#" data-section="user-management"><i class="fas fa-users"></i> Kelola Pengguna</a></li>
                    <li><a href="#" data-section="penjualan"><i class="fas fa-shopping-cart"></i> Data Penjualan</a></li>
                    <li><a href="#" data-section="laporan"><i class="fas fa-chart-bar"></i> Laporan</a></li>
                    <li><a href="#" data-section="pengaturan"><i class="fas fa-cog"></i> Pengaturan</a></li>
                `;
            } else if (currentUserRole === 'supervisor') {
                // Supervisor menu
                sidebarMenu.innerHTML = `
                    <li class="active"><a href="#" data-section="overview"><i class="fas fa-chart-line"></i> Overview</a></li>
                    <li><a href="#" data-section="kasir"><i class="fas fa-cash-register"></i> Kasir</a></li>
                    <li><a href="#" data-section="order-management"><i class="fas fa-clipboard-list"></i> Kelola Pesanan</a></li>
                    <li><a href="#" data-section="penjualan"><i class="fas fa-shopping-cart"></i> Data Penjualan</a></li>
                    <li><a href="#" data-section="laporan"><i class="fas fa-chart-bar"></i> Laporan</a></li>
                `;
            } else {
                // Kasir menu
                sidebarMenu.innerHTML = `
                    <li class="active"><a href="#" data-section="kasir"><i class="fas fa-cash-register"></i> Kasir</a></li>
                    <li><a href="#" data-section="order-management"><i class="fas fa-clipboard-list"></i> Kelola Pesanan</a></li>
                    <li><a href="#" data-section="penjualan"><i class="fas fa-shopping-cart"></i> Data Penjualan</a></li>
                `;
            }

            // Add event listeners to sidebar menu
            const sidebarLinks = sidebarMenu.querySelectorAll('a');
            const dashboardSections = document.querySelectorAll('.dashboard-section');

            sidebarLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();

                    // Remove active class from all links and sections
                    sidebarLinks.forEach(l => l.parentElement.classList.remove('active'));
                    dashboardSections.forEach(s => s.classList.remove('active'));

                    // Add active class to clicked link
                    this.parentElement.classList.add('active');

                    // Show corresponding section
                    const sectionId = this.getAttribute('data-section');

                    // Close sidebar on mobile after clicking a link
                    if (window.innerWidth <= 768) {
                        document.querySelector('.sidebar').classList.remove('open');
                    }

                    showDashboardSection(sectionId);
                });
            });
        }

        function showDashboardSection(sectionId) {
            // Hide all sections
            const dashboardSections = document.querySelectorAll('.dashboard-section');
            dashboardSections.forEach(s => s.classList.remove('active'));

            // Show selected section
            document.getElementById(sectionId).classList.add('active');

            // Initialize specific sections
            if (sectionId === 'kasir') {
                updateKasirDisplay();
            } else if (sectionId === 'menu-management') {
                updateMenuTable();
            } else if (sectionId === 'user-management') {
                updateUserTable();
                updateActivityLogDisplay();
            } else if (sectionId === 'penjualan') {
                updateSalesTable();
            } else if (sectionId === 'inventory-management') {
                updateInventoryTable();
            } else if (sectionId === 'order-management') {
                updateOrderTable();
            } else if (sectionId === 'overview') {
                initializeSalesChart();
                updateOverview();
            }
        }

        // =================================================================================
        // KASIR FUNCTIONS
        // =================================================================================
        // Kasir Functions
        function initializeKasir() {
            // Load menu items
            updateKasirDisplay();

            // Add event listeners to category buttons
            categoryButtonsKasir.forEach(button => {
                button.addEventListener('click', filterMenuKasir);
            });
            
            // Search listener
            searchMenuKasirInput.addEventListener('input', filterMenuKasir);
            
            // Discount listener
            cartDiscountInput.addEventListener('input', updateCartKasirDisplay);

            // Add event listeners to kasir buttons
            clearCartKasirBtn.addEventListener('click', clearCartKasir);
            checkoutKasirBtn.addEventListener('click', checkoutKasir);
            checkoutKasirBtn.setAttribute('title', 'Proses pembayaran pesanan');
            checkoutKasirBtn.setAttribute('aria-label', 'Proses pembayaran pesanan');
            saveOrderKasirBtn.addEventListener('click', saveOrderKasir);
            showQRCodeBtn.addEventListener('click', function() {                
                if (cartKasir.length === 0) {
                    Swal.fire('Keranjang Kosong', 'Tidak ada item untuk dibayar menggunakan QR.', 'warning');
                    return;
                }

                const total = cartKasir.reduce((sum, item) => sum + (item.price * item.quantity), 0);
                const qrCodeContainer = document.getElementById('qrCodeContainer');
                
                // Kosongkan QR code sebelumnya
                qrCodeContainer.innerHTML = '';

                // Buat QR code baru
                new QRCode(qrCodeContainer, {
                    text: `PEMBAYARAN SOTO LAMONGAN: Rp ${total.toLocaleString()}`, // Contoh data QR
                    width: 200,
                    height: 200
                });

                qrCodeModal.style.display = 'flex'; // Tampilkan modal
            });

            document.getElementById('confirmPayment').addEventListener('click', function() {
                Swal.fire('Pembayaran Dikonfirmasi', 'Terima kasih! Pembayaran Anda telah dikonfirmasi.', 'success');
            });

            // Add event listener to add menu button
            addMenuBtn.addEventListener('click', showAddMenuModal);

            // Add event listener to add user button
            if (addUserBtn) {
                addUserBtn.addEventListener('click', showAddUserModal);
            }
        }

        function updateKasirDisplay() {
            // Update menu items display
            menuItemsKasir.innerHTML = '';

            const menuImageMapping = {
                "Soto Ayam Lamongan": "download (1).webp",
                "Soto Daging Lamongan": "download.webp",
                "Nasi Goreng Lamongan": "Resep-Nasi-Goreng-Spesial.jpg",
                "Es Jeruk": "jeruk.jpeg",
                "Teh Manis": "tehmanis.webp",
                "Kerupuk Udang": "udang.jpeg",
                "Telur Rebus": "telur.jpeg",
                "Emping Melinjo": "emping.jpeg"
            };

            menuItems.filter(item => item.status === 'active').forEach(item => {
                const menuItemElement = document.createElement('div');
                const imageSrc = item.image || menuImageMapping[item.name] || 'OIP.webp';
                menuItemElement.className = 'menu-item-kasir';
                menuItemElement.setAttribute('data-category', item.category);
                menuItemElement.innerHTML = `
                    <img src="${imageSrc}" alt="${escapeHtml(item.name)}">
                    <h4>${escapeHtml(item.name)}</h4>
                    <div class="price">Rp ${item.price.toLocaleString()}</div>
                `;

                menuItemElement.addEventListener('click', () => addToCartKasir(item));
                menuItemsKasir.appendChild(menuItemElement);
            });

            // Update cart display
            updateCartKasirDisplay();
        }

        function filterMenuKasir(e) {
            // Handle category click
            let category = 'all';
            if (e.target.classList.contains('category-btn-kasir')) {
                category = e.target.getAttribute('data-category');
                // Update active button
                categoryButtonsKasir.forEach(button => {
                    button.classList.remove('active');
                });
                e.target.classList.add('active');
            } else {
                // If triggered by search, find active category
                category = document.querySelector('.category-btn-kasir.active').getAttribute('data-category');
            }

            const searchText = searchMenuKasirInput.value.toLowerCase();

            // Filter menu items
            const allMenuItems = document.querySelectorAll('.menu-item-kasir');
            allMenuItems.forEach(item => {
                const itemCategory = item.getAttribute('data-category');
                const itemName = item.querySelector('h4').textContent.toLowerCase();
                
                const matchesCategory = category === 'all' || itemCategory === category;
                const matchesSearch = itemName.includes(searchText);

                if (matchesCategory && matchesSearch) {
                    item.style.display = 'block';
                } else {
                    item.style.display = 'none';
                }
            });
        }

        function addToCartKasir(item) {
            // Check if item already in cart
            const existingItem = cartKasir.find(cartItem => cartItem.id === item.id);

            if (existingItem) {
                existingItem.quantity += 1;
            } else {
                cartKasir.push({
                    id: item.id,
                    name: item.name,
                    price: item.price,
                    quantity: 1
                });
            }

            updateCartKasirDisplay();
            showNotification(`${item.name} ditambahkan ke keranjang`);
        }

        function updateCartKasirDisplay() {
            keranjangItemsKasir.innerHTML = '';

            if (cartKasir.length === 0) {
                keranjangItemsKasir.innerHTML = '<p style="text-align: center; color: #777;">Keranjang kosong</p>';
                keranjangTotalKasir.textContent = 'Rp 0';
                return;
            }

            let total = 0;
            const discountPercent = parseInt(cartDiscountInput.value) || 0;

            cartKasir.forEach(item => {
                const itemTotal = item.price * item.quantity;
                total += itemTotal;

                const cartItemElement = document.createElement('div');
                cartItemElement.className = 'keranjang-item';
                cartItemElement.innerHTML = `
                    <div class="keranjang-item-info">
                        <div class="keranjang-item-name">${escapeHtml(item.name)}</div>
                        <div class="keranjang-item-price">Rp ${item.price.toLocaleString()}</div>
                    </div>
                    <div class="keranjang-item-controls">
                        <button class="quantity-btn-kasir decrease-kasir" data-id="${item.id}">-</button>
                        <span class="keranjang-item-quantity">${item.quantity}</span>
                        <button class="quantity-btn-kasir increase-kasir" data-id="${item.id}">+</button>
                        <button class="quantity-btn-kasir remove-kasir" data-id="${item.id}"><i class="fas fa-trash"></i></button>
                    </div>
                `;

                keranjangItemsKasir.appendChild(cartItemElement);
            });

            // Add event listeners to quantity buttons
            document.querySelectorAll('.decrease-kasir').forEach(button => {
                button.addEventListener('click', decreaseQuantityKasir);
            });

            document.querySelectorAll('.increase-kasir').forEach(button => {
                button.addEventListener('click', increaseQuantityKasir);
            });

            document.querySelectorAll('.remove-kasir').forEach(button => {
                button.addEventListener('click', removeItemKasir);
            });

            // Calculate Discount
            const discountAmount = total * (discountPercent / 100);
            const finalTotal = total - discountAmount;

            // Update total
            keranjangTotalKasir.innerHTML = `Rp ${finalTotal.toLocaleString()} <br><small style="font-size:12px; color:#777;">(Disc: ${discountPercent}%)</small>`;
        }

        function decreaseQuantityKasir(e) {
            const id = parseInt(e.target.getAttribute('data-id'));
            const item = cartKasir.find(item => item.id === id);

            if (item.quantity > 1) {
                item.quantity -= 1;
            } else {
                cartKasir = cartKasir.filter(item => item.id !== id);
            }
            
            updateCartKasirDisplay();
        }

        function increaseQuantityKasir(e) {
            const id = parseInt(e.target.getAttribute('data-id'));
            const item = cartKasir.find(item => item.id === id);
            item.quantity += 1;
            updateCartKasirDisplay();
        }

        function removeItemKasir(e) {
            const id = parseInt(e.target.closest('button').getAttribute('data-id'));
            cartKasir = cartKasir.filter(item => item.id !== id);
            updateCartKasirDisplay();
        }

        function clearCartKasir() {
            cartKasir = [];
            updateCartKasirDisplay();
            showNotification('Keranjang telah dikosongkan');
        }

        function checkoutKasir() {
            if (!currentShift && currentUserRole === 'kasir') {
                Swal.fire('Shift Belum Dibuka', 'Silakan buka shift terlebih dahulu untuk melakukan transaksi.', 'warning');
                return;
            }

            if (cartKasir.length === 0) {
                Swal.fire('Keranjang Kosong', 'Tambahkan item terlebih dahulu sebelum proses pembayaran.', 'warning');
                return;
            }

            Swal.fire({
                title: 'Konfirmasi Pembayaran',
                text: "Apakah Anda yakin ingin memproses pembayaran?",
                icon: 'question',
                showCancelButton: true,
                confirmButtonColor: '#2a9d8f',
                cancelButtonColor: '#e63946',
                confirmButtonText: 'Ya, Proses!',
                cancelButtonText: 'Batal'
            }).then((result) => {
                if (result.isConfirmed) {
                    generateReceiptKasir();
                    Swal.fire(
                        'Berhasil!',
                        'Pembayaran telah diproses.',
                        'success'
                    );
                }
            });
        }

        function saveOrderKasir() {
            if (cartKasir.length === 0) {
                Swal.fire('Keranjang Kosong', 'Tambahkan item terlebih dahulu untuk menyimpan pesanan.', 'warning');
                return;
            }

            // Clear cart after saving
            cartKasir = [];
            updateCartKasirDisplay();
        }

        function generateReceiptKasir() {
            const now = new Date();
            const dateTime = now.toLocaleString('id-ID');
            const orderId = `ORD-${orderNumber.toString().padStart(3, '0')}`;
            const discountPercent = parseInt(cartDiscountInput.value) || 0;
            const paymentMethod = paymentMethodSelect.value;

            let receiptHTML = `
                <div class="receipt-header">
                    <h2>Soto Lamongan Asli</h2>
                    <p>Jl. Raya Lamongan No. 123</p>
                    <p>Lamongan, Jawa Timur</p>
                </div>
                <div class="receipt-info">
                    <p><strong>No. Pesanan:</strong> ${orderId}</p>
                    <p><strong>Tanggal:</strong> ${dateTime}</p>
                    <p><strong>Kasir:</strong> ${users.find(u => u.role === currentUserRole)?.username || 'Kasir'}</p>
                    <p><strong>Metode:</strong> ${paymentMethod}</p>
                </div>
                <table class="receipt-items">
                    <thead>
                        <tr>
                            <th>Item</th>
                            <th>Qty</th>
                            <th>Subtotal</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            let total = 0;
            cartKasir.forEach(item => {
                const itemTotal = item.price * item.quantity;
                total += itemTotal;

                receiptHTML += `
                    <tr>
                        <td>${escapeHtml(item.name)}</td>
                        <td>${item.quantity}</td>
                        <td>Rp ${itemTotal.toLocaleString()}</td>
                    </tr>
                `;
                
            });

            const discountAmount = total * (discountPercent / 100);
            const finalTotal = total - discountAmount;

            // Record the sale
            salesData.push({
                id: orderId,
                date: now.toISOString(),
                kasir: users.find(u => u.role === currentUserRole)?.username || 'Kasir',
                total: finalTotal,
                discount: discountPercent,
                paymentMethod: paymentMethod,
                status: 'Selesai',
                items: JSON.parse(JSON.stringify(cartKasir)) // Deep copy cart items
            });
            orderNumber++;

            receiptHTML += `
                    </tbody>
                </table>
                <div class="receipt-total">
                    <span>Subtotal:</span>
                    <span>Rp ${total.toLocaleString()}</span>
                </div>
                <div class="receipt-total" style="border-top:none; margin-top:5px;">
                    <span>Total:</span>
                    <span>Rp ${finalTotal.toLocaleString()}</span>
                </div>
                <div class="receipt-footer">
                    <p>Terima kasih atas kunjungan Anda!</p>
                    <p>Silakan datang kembali</p>
                </div>
            `;

            receiptContent.innerHTML = receiptHTML;
            receiptModal.style.display = 'flex';

            // Clear cart after generating receipt
            cartKasir = [];
            updateCartKasirDisplay();

            // Update overview, sales table, and chart
            updateOverview();
            updateSalesTable();
            initializeSalesChart();
        }

        // =================================================================================
        // MENU MANAGEMENT FUNCTIONS (ADMIN)
        // =================================================================================
        // Menu Management Functions
        function updateMenuTable() {
            menuTableBody.innerHTML = '';

            menuItems.forEach((item, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${escapeHtml(item.name)}</td>
                    <td>${escapeHtml(item.category)}</td>
                    <td>Rp ${item.price.toLocaleString()}</td>
                    <td>${item.status === 'active' ? 'Aktif' : 'Nonaktif'}</td>
                    <td>
                        <button class="btn btn-small edit-menu" data-id="${item.id}">Edit</button>
                        <button class="btn btn-small btn-danger delete-menu" data-id="${item.id}">${item.status === 'active' ? 'Nonaktifkan' : 'Aktifkan'}</button>
                    </td>
                `;

                menuTableBody.appendChild(row);
            });

            // Add event listeners to menu buttons
            document.querySelectorAll('.edit-menu').forEach(button => {
                button.addEventListener('click', editMenuItem);
            });

            document.querySelectorAll('.delete-menu').forEach(button => {
                button.addEventListener('click', toggleMenuItemStatus);
            });
        }

        function showAddMenuModal() {
            addMenuModal.style.display = 'flex';
        }

        addMenuForm.addEventListener('submit', function(e) {
            e.preventDefault();
            const name = document.getElementById('menuName').value;
            const category = document.getElementById('menuCategory').value;
            const price = parseInt(document.getElementById('menuPrice').value);
            const description = document.getElementById('menuDescription').value;
            const image = document.getElementById('menuImage').value;

            // Generate new ID
            const newId = menuItems.length > 0 ? Math.max(...menuItems.map(item => item.id)) + 1 : 1;

            // Add new menu item
            menuItems.push({
                id: newId,
                name: escapeHtml(name),
                category: category,
                price: price,
                description: escapeHtml(description),
                image: image,
                stock: 0, // Default stock for new item
                status: 'active'
            });

            // Update displays
            updateMenuTable();
            updateKasirDisplay();

            // Close modal and show success message
            addMenuModal.style.display = 'none';
            showNotification(`Menu ${name} berhasil ditambahkan`);
            logActivity(`Added Menu: ${name}`);
            addMenuForm.reset();
        });

        function editMenuItem(e) {
            const id = parseInt(e.target.getAttribute('data-id'));
            const item = menuItems.find(item => item.id === id);

            // Populate Modal
            document.getElementById('editMenuId').value = item.id;
            document.getElementById('editMenuName').value = item.name;
            document.getElementById('editMenuCategory').value = item.category;
            document.getElementById('editMenuPrice').value = item.price;
            document.getElementById('editMenuImage').value = item.image || '';
            
            editMenuModal.style.display = 'flex';
        }
        
        // Handle Edit Form Submit
        editMenuForm.addEventListener('submit', function(e) {
            e.preventDefault();
            const id = parseInt(document.getElementById('editMenuId').value);
            const name = document.getElementById('editMenuName').value;
            const category = document.getElementById('editMenuCategory').value;
            const price = parseInt(document.getElementById('editMenuPrice').value);
            const image = document.getElementById('editMenuImage').value;
            
            const item = menuItems.find(i => i.id === id);
            if (item) {
                item.name = name;
                item.category = category;
                item.price = price;
                item.image = image;
                
                updateMenuTable();
                updateKasirDisplay();
                editMenuModal.style.display = 'none';
                showNotification(`Menu ${name} berhasil diperbarui`);
                logActivity(`Edited Menu: ${name}`);
            }
        });

        function toggleMenuItemStatus(e) {
            const id = parseInt(e.target.getAttribute('data-id'));
            const item = menuItems.find(item => item.id === id);

            item.status = item.status === 'active' ? 'inactive' : 'active';
            updateMenuTable();
            updateKasirDisplay();

            showNotification(`Menu ${item.name} ${item.status === 'active' ? 'diaktifkan' : 'dinonaktifkan'}`);
            logActivity(`Changed Menu Status: ${item.name} to ${item.status}`);
        }

        // =================================================================================
        // USER MANAGEMENT FUNCTIONS (ADMIN)
        // =================================================================================
        // User Management Functions
        function updateUserTable() {
            userTableBody.innerHTML = '';

            users.forEach((user, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${escapeHtml(user.username)}</td>
                    <td>${escapeHtml(user.email)}</td>
                    <td>${user.role}</td>
                    <td>${user.status === 'active' ? 'Aktif' : 'Nonaktif'}</td>
                    <td>
                        <button class="btn btn-small edit-user" data-username="${user.username}">Edit</button>
                        <button class="btn btn-small btn-danger delete-user" data-username="${user.username}">${user.status === 'active' ? 'Nonaktifkan' : 'Aktifkan'}</button>
                    </td>
                `;

                userTableBody.appendChild(row);
            });

            // Add event listeners to user buttons
            document.querySelectorAll('.edit-user').forEach(button => {
                button.addEventListener('click', editUser);
            });

            document.querySelectorAll('.delete-user').forEach(button => {
                button.addEventListener('click', toggleUserStatus);
            });
        }

        function showAddUserModal() {
            Swal.fire({
                title: 'Tambah Pengguna Baru',
                html:
                    '<input id="swal-input1" class="swal2-input" placeholder="Username">' +
                    '<input id="swal-input2" class="swal2-input" placeholder="Email">' +
                    '<input id="swal-input3" class="swal2-input" placeholder="Password" type="password">' +
                    '<select id="swal-input4" class="swal2-input">' +
                    '<option value="kasir">Kasir</option>' +
                    '<option value="admin">Admin</option>' +
                    '<option value="supervisor">Supervisor</option>' +
                    '</select>',
                focusConfirm: false,
                showCancelButton: true,
                confirmButtonText: 'Tambah',
                cancelButtonText: 'Batal',
                preConfirm: () => {
                    return [
                        document.getElementById('swal-input1').value,
                        document.getElementById('swal-input2').value,
                        document.getElementById('swal-input3').value,
                        document.getElementById('swal-input4').value
                    ]
                }
            }).then((result) => {
                if (result.isConfirmed) {
                    const [username, email, password, role] = result.value;
                    if (!username || !email || !password) {
                        Swal.fire('Error', 'Semua field harus diisi', 'error');
                        return;
                    }
                    
                    // Tambahkan user baru ke sistem
                    // Note: In a real app, password should be hashed here too. 
                    // For this modal, we'll assume admin sets a temp password or we hash it.
                    users.push({ username: escapeHtml(username), email: escapeHtml(email), password: password, role, status: 'active' });
                    saveUsersToLocalStorage();
                    updateUserTable();
                    showNotification(`Pengguna ${username} berhasil ditambahkan`);
                }
            });
        }

        function editUser(e) {
            const username = e.target.getAttribute('data-username');
            const userIndex = users.findIndex(u => u.username === username);
            
            if (userIndex === -1) return;
            const user = users[userIndex];

            Swal.fire({
                title: `Edit Pengguna: ${user.username}`,
                html:
                    '<div style="text-align: left; margin-bottom: 5px;"><label>Email</label></div>' +
                    `<input id="swal-edit-email" class="swal2-input" placeholder="Email" value="${user.email}" style="margin-top: 0;">` +
                    '<div style="text-align: left; margin-bottom: 5px; margin-top: 15px;"><label>Role</label></div>' +
                    `<select id="swal-edit-role" class="swal2-input" style="margin-top: 0;">` +
                    `<option value="kasir" ${user.role === 'kasir' ? 'selected' : ''}>Kasir</option>` +
                    `<option value="admin" ${user.role === 'admin' ? 'selected' : ''}>Admin</option>` +
                    `<option value="supervisor" ${user.role === 'supervisor' ? 'selected' : ''}>Supervisor</option>` +
                    `</select>` +
                    '<div style="text-align: left; margin-bottom: 5px; margin-top: 15px;"><label>Password Baru (Opsional)</label></div>' +
                    `<input id="swal-edit-password" class="swal2-input" placeholder="Biarkan kosong jika tidak diganti" type="password" style="margin-top: 0;">`,
                focusConfirm: false,
                showCancelButton: true,
                confirmButtonText: 'Simpan Perubahan',
                cancelButtonText: 'Batal',
                preConfirm: () => {
                    return {
                        email: document.getElementById('swal-edit-email').value,
                        role: document.getElementById('swal-edit-role').value,
                        password: document.getElementById('swal-edit-password').value
                    }
                }
            }).then((result) => {
                if (result.isConfirmed) {
                    const { email, role, password } = result.value;
                    
                    if (!email) {
                        Swal.fire('Error', 'Email harus diisi', 'error');
                        return;
                    }
                    
                    // Update user data
                    users[userIndex].email = email;
                    users[userIndex].role = role;
                    if (password) {
                        users[userIndex].password = password;
                    }
                    saveUsersToLocalStorage();
                    
                    updateUserTable();
                    showNotification(`Data pengguna ${user.username} berhasil diperbarui`);
                    logActivity(`Updated User: ${user.username}`);
                }
            });
        }

        function toggleUserStatus(e) {
            const username = e.target.getAttribute('data-username');
            const user = users.find(u => u.username === username);

            user.status = user.status === 'active' ? 'inactive' : 'active';
            saveUsersToLocalStorage();
            updateUserTable();

            showNotification(`Pengguna ${user.username} ${user.status === 'active' ? 'diaktifkan' : 'dinonaktifkan'}`);
            logActivity(`Changed User Status: ${user.username} to ${user.status}`);
        }
        
        function updateActivityLogDisplay() {
            const container = document.getElementById('activityLogContainer');
            if (!container) return;
            
            if (activityLog.length === 0) {
                container.innerHTML = '<p style="padding: 10px; color: #777;">Belum ada aktivitas tercatat.</p>';
                return;
            }
            
            container.innerHTML = activityLog.map(log => `
                <div class="log-entry">
                    <div class="log-time">${new Date(log.timestamp).toLocaleString()}</div>
                    <span class="log-user">[${log.user}]</span> <span class="log-action">${escapeHtml(log.action)}</span>
                </div>
            `).join('');
        }

        // =================================================================================
        // ORDER MANAGEMENT FUNCTIONS
        // =================================================================================
        function initializeOrderManagement() {
            // Populate menu dropdown
            populateOrderMenu();

            // Add event listeners to update price and total
            orderMenuSelect.addEventListener('change', updateOrderPrice);
            orderQuantityInput.addEventListener('input', updateOrderPrice);

            // Add form submit listener
            addOrderForm.addEventListener('submit', addNewOrder);
        }

        function populateOrderMenu() {
            orderMenuSelect.innerHTML = '<option value="">Pilih Menu</option>';
            menuItems.filter(item => item.status === 'active').forEach(item => {
                const option = document.createElement('option');
                option.value = item.id;
                option.textContent = item.name;
                orderMenuSelect.appendChild(option);
            });
        }

        function updateOrderPrice() {
            const selectedMenuId = parseInt(orderMenuSelect.value);
            const quantity = parseInt(orderQuantityInput.value) || 0;

            if (selectedMenuId) {
                const menuItem = menuItems.find(item => item.id === selectedMenuId);
                if (menuItem) {
                    const price = menuItem.price;
                    const total = price * quantity;
                    orderPriceDisplay.value = `Rp ${price.toLocaleString()}`;
                    orderTotalDisplay.textContent = `Rp ${total.toLocaleString()}`;
                }
            } else {
                orderPriceDisplay.value = 'Rp 0';
                orderTotalDisplay.textContent = 'Rp 0';
            }
        }

        function addNewOrder(e) {
            e.preventDefault();

            const customerName = document.getElementById('orderCustomerName').value.trim();
            const menuId = parseInt(orderMenuSelect.value);
            const quantity = parseInt(orderQuantityInput.value);

            if (!customerName) {
                Swal.fire('Validasi Gagal', 'Nama Pemesan tidak boleh kosong.', 'warning');
                return;
            }

            if (!menuId || quantity < 1) {
                Swal.fire('Validasi Gagal', 'Silakan pilih menu dan masukkan jumlah yang valid.', 'warning');
                return;
            }

            const menuItem = menuItems.find(item => item.id === menuId);
            const newOrderId = `P-${Date.now()}`; // Unique ID for pending order

            const newOrder = {
                id: newOrderId,
                customerName: escapeHtml(customerName),
                menuName: escapeHtml(menuItem.name),
                quantity: quantity,
                unitPrice: menuItem.price,
                totalPrice: menuItem.price * quantity,
                orderTime: new Date()
            };

            pendingOrders.push(newOrder);
            updateOrderTable();
            addOrderForm.reset();
            updateOrderPrice(); // Reset price display
            showNotification(`Pesanan untuk ${customerName} telah ditambahkan.`);
        }

        function updateOrderTable() {
            orderTableBody.innerHTML = '';
            pendingOrders.slice().reverse().forEach(order => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${order.id}</td>
                    <td>${escapeHtml(order.customerName)}</td>
                    <td>${escapeHtml(order.menuName)}</td>
                    <td>${order.quantity}</td>
                    <td>Rp ${order.unitPrice.toLocaleString()}</td>
                    <td>Rp ${order.totalPrice.toLocaleString()}</td>
                    <td>${order.orderTime.toLocaleTimeString('id-ID')}</td>
                    <td><button class="btn btn-small btn-success" onclick="completeOrder('${order.id}')">Selesai</button></td>
                `;
                orderTableBody.appendChild(row);
            });
        }

        function completeOrder(orderId) {
            // 1. Find the order in the pendingOrders array
            const orderToComplete = pendingOrders.find(order => order.id === orderId);
            if (!orderToComplete) return;

            // 2. Create a new sales data object from the completed order
            const newSale = {
                id: orderToComplete.id,
                date: orderToComplete.orderTime.toISOString(),
                kasir: orderToComplete.customerName, // Menggunakan nama pemesan sebagai 'kasir' untuk data ini
                total: orderToComplete.totalPrice,
                status: 'Selesai',
                items: [{
                    name: orderToComplete.menuName,
                    quantity: orderToComplete.quantity,
                    price: orderToComplete.unitPrice
                }]
            };

            // 3. Add the new sale to the salesData array
            salesData.push(newSale);

            // 4. Remove the order from the pendingOrders list
            pendingOrders = pendingOrders.filter(order => order.id !== orderId);

            // 5. Update the tables and show notification
            updateOrderTable();
            updateSalesTable(); // Perbarui juga tabel penjualan
            showNotification(`Pesanan ${orderId} ditandai selesai.`);
        }

        // =================================================================================
        // SALES DATA AND OVERVIEW FUNCTIONS
        // =================================================================================
        // Sales Data Functions
        function updateSalesTable(applyFilter = false) {
            const tbody = document.getElementById('salesTableBody');
            tbody.innerHTML = '';
            
            let displayData = salesData.slice().reverse();

            // Apply Filter
            if (applyFilter) {
                const filterDate = salesFilterDate.value;
                if (filterDate) {
                    displayData = displayData.filter(sale => 
                        new Date(sale.date).toISOString().split('T')[0] === filterDate
                    );
                }
                // Reset to page 1 when filtering
                currentSalesPage = 1;
            }

            // Apply Pagination
            const totalPages = Math.ceil(displayData.length / itemsPerPage) || 1;
            if (currentSalesPage > totalPages) currentSalesPage = totalPages;
            
            const paginatedData = paginateData(displayData, currentSalesPage, itemsPerPage);

            // Render Rows
            paginatedData.forEach((sale, index) => {
                const row = document.createElement('tr');
                const saleDate = new Date(sale.date);
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${sale.id}</td>
                    <td>${saleDate.toLocaleString('id-ID')}</td>
                    <td>${escapeHtml(sale.kasir)}</td>
                    <td>Rp ${sale.total.toLocaleString()}</td>
                    <td><span style="background-color: #2a9d8f; color: white; padding: 5px 10px; border-radius: 5px;">${sale.status}</span></td>
                `;

                tbody.appendChild(row);
            });

            // Update Pagination Controls
            document.getElementById('pageIndicator').textContent = `Halaman ${currentSalesPage} dari ${totalPages}`;
            document.getElementById('prevPageBtn').disabled = currentSalesPage === 1;
            document.getElementById('nextPageBtn').disabled = currentSalesPage === totalPages;

            // Add event listener for reset button
            const resetSalesBtn = document.getElementById('resetSalesBtn');
            if (resetSalesBtn) resetSalesBtn.addEventListener('click', resetSalesData);
        }

        function changeSalesPage(direction) {
            currentSalesPage += direction;
            updateSalesTable(document.getElementById('salesFilterDate').value !== '');
        }

        // Chart.js Function
        function initializeSalesChart(startDateInput = null, endDateInput = null) {
            const ctx = document.getElementById('salesChart').getContext('2d');

            if (salesChart) {
                salesChart.destroy();
            }

            const labels = [];
            const data = [];
            let title = "Grafik Penjualan 7 Hari Terakhir";

            if (startDateInput && endDateInput) {
                const start = new Date(startDateInput + 'T00:00:00');
                const end = new Date(endDateInput + 'T00:00:00');
                
                if (start > end) {
                    Swal.fire('Error', 'Tanggal mulai tidak boleh lebih besar dari tanggal akhir', 'error');
                    return;
                }

                title = `Grafik Penjualan ${start.toLocaleDateString('id-ID')} - ${end.toLocaleDateString('id-ID')}`;
                const chartTitleElem = document.getElementById('chartTitle');
                if(chartTitleElem) chartTitleElem.textContent = title;

                for (let d = new Date(start); d <= end; d.setDate(d.getDate() + 1)) {
                    labels.push(new Date(d).toLocaleDateString('id-ID', { day: 'numeric', month: 'short' }));
                    const dateString = new Date(d).toDateString();
                    const dailySales = salesData.filter(sale => new Date(sale.date).toDateString() === dateString);
                    const dailyTotal = dailySales.reduce((sum, sale) => sum + sale.total, 0);
                    data.push(dailyTotal);
                }
            } else {
                // Default 7 days
                const chartTitleElem = document.getElementById('chartTitle');
                if(chartTitleElem) chartTitleElem.textContent = title;

                for (let i = 6; i >= 0; i--) {
                    const d = new Date();
                    d.setDate(d.getDate() - i);
                    labels.push(d.toLocaleDateString('id-ID', { weekday: 'short' }));
    
                    const dailySales = salesData.filter(sale => new Date(sale.date).toDateString() === d.toDateString());
                    const dailyTotal = dailySales.reduce((sum, sale) => sum + sale.total, 0);
                    data.push(dailyTotal);
                }
            }

            salesChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Pendapatan (Rp)',
                        data: data,
                        backgroundColor: 'rgba(230, 57, 70, 0.2)',
                        borderColor: '#e63946',
                        borderWidth: 2,
                        tension: 0.4,
                        fill: true,
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value, index, values) {
                                    return 'Rp ' + value.toLocaleString();
                                }
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `Pendapatan: Rp ${context.parsed.y.toLocaleString()}`;
                                }
                            }
                        }
                    }
                }
            });
        }

        // Overview and Reset Functions
        function updateOverview() {
            const today = new Date().toDateString();
            const salesToday = salesData.filter(sale => new Date(sale.date).toDateString() === today);

            // 1. Calculate Revenue Today
            const revenueToday = salesToday.reduce((sum, sale) => sum + sale.total, 0);
            overviewRevenueToday.textContent = `Rp ${revenueToday.toLocaleString()}`;

            // 2. Calculate Total Orders Today
            const totalOrdersToday = salesToday.length;
            overviewTotalOrders.textContent = totalOrdersToday;

            // 3. Calculate Best Seller (all time)
            if (salesData.length > 0) {
                const itemCounts = {};
                salesData.forEach(sale => {
                    sale.items.forEach(item => {
                        if (itemCounts[item.name]) {
                            itemCounts[item.name] += item.quantity;
                        } else {
                            itemCounts[item.name] = item.quantity;
                        }
                    });
                });

                let bestSeller = '-';
                let maxQuantity = 0;
                for (const itemName in itemCounts) {
                    if (itemCounts[itemName] > maxQuantity) {
                        maxQuantity = itemCounts[itemName];
                        bestSeller = itemName;
                    }
                }
                overviewBestSeller.textContent = bestSeller;
            } else {
                overviewBestSeller.textContent = '-';
            }
        }

        function resetSalesData() {
            Swal.fire({
                title: 'Anda Yakin?',
                text: "Semua data penjualan akan dihapus permanen dan tidak dapat dikembalikan. Ini juga akan mereset ringkasan penjualan.",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#e63946',
                cancelButtonColor: '#3085d6',
                confirmButtonText: 'Ya, Hapus Semua!',
                cancelButtonText: 'Batal'
            }).then((result) => {
                if (result.isConfirmed) {
                    salesData = [];
                    orderNumber = 1;
                    updateSalesTable();
                    updateOverview();
                    initializeSalesChart();
                    logActivity('Reset All Sales Data');
                    Swal.fire('Dihapus!', 'Semua data penjualan telah berhasil dihapus.', 'success');
                }
            });
        }

        // =================================================================================
        // REPORTING FUNCTIONS
        // =================================================================================
        // Report Generation Function
        function generateSalesReport() {
            const startDateInput = document.getElementById('reportStartDate').value;
            const endDateInput = document.getElementById('reportEndDate').value;

            if (!startDateInput || !endDateInput) {
                Swal.fire('Tanggal Tidak Lengkap', 'Silakan pilih tanggal mulai dan tanggal akhir.', 'warning');
                return;
            }

            const startDate = new Date(startDateInput);
            const endDate = new Date(endDateInput);
            endDate.setHours(23, 59, 59, 999); // Set end date to the end of the day

            const filteredSales = salesData.filter(sale => {
                const saleDate = new Date(sale.date);
                return saleDate >= startDate && saleDate <= endDate;
            });

            reportResultDiv.style.display = 'block';

            if (filteredSales.length === 0) {
                reportResultDiv.innerHTML = '<p style="text-align: center;">Tidak ada data penjualan pada periode yang dipilih.</p>';
                return;
            }

            const totalRevenue = filteredSales.reduce((sum, sale) => sum + sale.total, 0);
            const totalOrders = filteredSales.length;
            const itemSummary = {};

            filteredSales.forEach(sale => {
                sale.items.forEach(item => {
                    if (itemSummary[item.name]) {
                        itemSummary[item.name] += item.quantity;
                    } else {
                        itemSummary[item.name] = item.quantity;
                    }
                });
            });

            let itemsHtml = '<ul>';
            for (const itemName in itemSummary) {
                itemsHtml += `<li>${itemName}: <strong>${itemSummary[itemName]}</strong> terjual</li>`;
            }
            itemsHtml += '</ul>';

            reportResultDiv.innerHTML = `
                <h3 style="margin-bottom: 15px; color: #e63946;">Laporan Penjualan Periode ${startDate.toLocaleDateString('id-ID')} - ${endDate.toLocaleDateString('id-ID')}</h3>
                <p><strong>Total Pendapatan:</strong> Rp ${totalRevenue.toLocaleString()}</p>
                <p><strong>Total Pesanan:</strong> ${totalOrders} transaksi</p>
                <hr style="margin: 15px 0;">
                <h4 style="margin-bottom: 10px;">Ringkasan Item Terjual:</h4>
                ${itemsHtml}
            `;
        }
        
        function exportToExcel() {
            if (salesData.length === 0) {
                Swal.fire('Data Kosong', 'Tidak ada data penjualan untuk diekspor.', 'warning');
                return;
            }
            
            let csvContent = "data:text/csv;charset=utf-8,";
            csvContent += "ID Pesanan,Tanggal,Kasir,Metode Pembayaran,Diskon (%),Total,Status\n";
            
            salesData.forEach(row => {
                csvContent += `${row.id},${new Date(row.date).toLocaleString()},${row.kasir},${row.paymentMethod || 'Cash'},${row.discount || 0},${row.total},${row.status}\n`;
            });
            
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", "laporan_penjualan_soto_lamongan.csv");
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            logActivity('Exported Sales Report');
        }
        
        function exportToPdf() {
            if (salesData.length === 0) {
                Swal.fire('Data Kosong', 'Tidak ada data untuk diekspor.', 'warning');
                return;
            }

            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();

            doc.text("Laporan Penjualan Soto Lamongan", 14, 15);
            doc.setFontSize(10);
            doc.text(`Dicetak pada: ${new Date().toLocaleString()}`, 14, 22);

            const tableColumn = ["ID", "Tanggal", "Kasir", "Metode", "Total", "Status"];
            const tableRows = [];

            salesData.forEach(sale => {
                const saleData = [
                    sale.id,
                    new Date(sale.date).toLocaleDateString(),
                    sale.kasir,
                    sale.paymentMethod || 'Cash',
                    `Rp ${sale.total.toLocaleString()}`,
                    sale.status
                ];
                tableRows.push(saleData);
            });

            doc.autoTable({
                head: [tableColumn],
                body: tableRows,
                startY: 30,
            });

            doc.save(`laporan_penjualan_${new Date().toISOString().slice(0,10)}.pdf`);
            logActivity('Exported PDF Report');
        }

        // =================================================================================
        // INVENTORY MANAGEMENT FUNCTIONS
        // =================================================================================
        function initializeInventory() {
            document.getElementById('btnStockIn').addEventListener('click', () => openStockModal('in'));
            document.getElementById('btnStockOut').addEventListener('click', () => openStockModal('out'));
            stockForm.addEventListener('submit', handleStockFormSubmit);
        }

        function updateInventoryTable() {
            inventoryTableBody.innerHTML = '';
            
            menuItems.forEach((item, index) => {
                let statusBadge = '';
                if (item.stock <= 0) {
                    statusBadge = '<span class="stock-badge stock-out">Habis</span>';
                } else if (item.stock < 10) {
                    statusBadge = '<span class="stock-badge stock-low">Menipis</span>';
                } else {
                    statusBadge = '<span class="stock-badge stock-ok">Aman</span>';
                }

                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${escapeHtml(item.name)}</td>
                    <td>${escapeHtml(item.category)}</td>
                    <td><strong>${item.stock}</strong></td>
                    <td>${statusBadge}</td>
                    <td>
                        <button class="btn btn-small btn-danger delete-inventory" data-id="${item.id}"><i class="fas fa-trash"></i> Hapus</button>
                    </td>
                `;
                inventoryTableBody.appendChild(row);
            });
            
            updateStockHistoryTable();
            
            // Add event listeners for delete buttons
            document.querySelectorAll('.delete-inventory').forEach(button => {
                button.addEventListener('click', handleDeleteInventoryItem);
            });
        }

        function updateStockHistoryTable() {
            stockHistoryTableBody.innerHTML = '';
            // Show last 10 history items
            stockHistory.slice().reverse().slice(0, 10).forEach(history => {
                const row = document.createElement('tr');
                let typeColor, typeLabel;
                
                if (history.type === 'in') {
                    typeColor = 'green';
                    typeLabel = 'Masuk (+)';
                } else if (history.type === 'delete') {
                    typeColor = 'darkred';
                    typeLabel = 'Dihapus (X)';
                } else {
                    typeColor = 'red';
                    typeLabel = 'Keluar (-)';
                }
                
                row.innerHTML = `
                    <td>${new Date(history.date).toLocaleString('id-ID')}</td>
                    <td>${escapeHtml(history.itemName)}</td>
                    <td style="color: ${typeColor}; font-weight: bold;">${typeLabel}</td>
                    <td>${history.quantity}</td>
                    <td>${escapeHtml(history.reason)}</td>
                `;
                stockHistoryTableBody.appendChild(row);
            });
        }

        function openStockModal(type) {
            const modalTitle = document.getElementById('stockModalTitle');
            const stockTypeInput = document.getElementById('stockType');
            const stockItemSelect = document.getElementById('stockItem');
            
            modalTitle.textContent = type === 'in' ? 'Input Barang Masuk' : 'Input Barang Keluar (Manual)';
            stockTypeInput.value = type;
            
            // Populate select
            stockItemSelect.innerHTML = '<option value="">-- Pilih Barang --</option>';
            menuItems.forEach(item => {
                const option = document.createElement('option');
                option.value = item.id;
                option.textContent = `${item.name} (Stok: ${item.stock})`;
                stockItemSelect.appendChild(option);
            });
            
            stockModal.style.display = 'flex';
        }

        function handleStockFormSubmit(e) {
            e.preventDefault();
            const type = document.getElementById('stockType').value;
            const itemId = parseInt(document.getElementById('stockItem').value);
            const quantity = parseInt(document.getElementById('stockQuantity').value);
            const reason = document.getElementById('stockReason').value;
            
            processStockChange(itemId, quantity, type, reason);
            
            stockModal.style.display = 'none';
            stockForm.reset();
            updateInventoryTable();
            checkLowStock();
            showNotification('Stok berhasil diperbarui');
        }

        function processStockChange(identifier, quantity, type, reason, isName = false) {
            let item;
            if (isName) {
                item = menuItems.find(i => i.name === identifier);
            } else {
                item = menuItems.find(i => i.id === identifier);
            }
            
            if (item) {
                if (type === 'in') {
                    item.stock += quantity;
                } else {
                    item.stock -= quantity;
                }
                
                stockHistory.push({
                    date: new Date(),
                    itemName: item.name,
                    type: type,
                    quantity: quantity,
                    reason: escapeHtml(reason)
                });
            }
        }
        
        function checkLowStock() {
            const lowStockItems = menuItems.filter(item => item.stock <= 10);
            const alertArea = document.getElementById('lowStockAlertArea');
            
            if (!alertArea) return;
            alertArea.innerHTML = '';
            
            if (lowStockItems.length > 0) {
                lowStockItems.forEach(item => {
                    const alert = document.createElement('div');
                    alert.style.cssText = 'background-color: #fff3cd; color: #856404; padding: 10px; border-radius: 5px; margin-bottom: 5px; border: 1px solid #ffeeba;';
                    alert.innerHTML = `<i class="fas fa-exclamation-triangle"></i> Stok <strong>${item.name}</strong> menipis (Sisa: ${item.stock})`;
                    alertArea.appendChild(alert);
                });
            }
        }

        // =================================================================================
        // SHIFT MANAGEMENT FUNCTIONS
        // =================================================================================
        function initializeShiftManagement() {
            shiftBtn.addEventListener('click', openShiftModal);
            shiftForm.addEventListener('submit', handleShiftSubmit);
            updateShiftButton();
        }

        function updateShiftButton() {
            if (currentShift) {
                shiftBtn.textContent = `Shift: Buka (${currentShift.kasir})`;
                shiftBtn.classList.remove('btn-danger');
                shiftBtn.classList.add('btn-success');
            } else {
                shiftBtn.textContent = 'Shift: Tutup';
                shiftBtn.classList.remove('btn-success');
                shiftBtn.classList.add('btn-danger');
            }
        }

        function openShiftModal() {
            const user = users.find(u => u.role === currentUserRole)?.username || 'User';
            document.getElementById('shiftKasirName').value = user;
            
            if (currentShift) {
                shiftModalTitle.textContent = "Tutup Shift";
                document.getElementById('shiftSubmitBtn').textContent = "Tutup Shift & Cetak Laporan";
            } else {
                shiftModalTitle.textContent = "Buka Shift";
                document.getElementById('shiftSubmitBtn').textContent = "Mulai Shift";
            }
            document.getElementById('shiftAmount').value = '';
            shiftModal.style.display = 'flex';
        }

        function handleShiftSubmit(e) {
            e.preventDefault();
            const amount = parseInt(document.getElementById('shiftAmount').value);
            const user = document.getElementById('shiftKasirName').value;

            if (currentShift) {
                // Closing Shift
                const endTime = new Date();
                const duration = Math.round((endTime - new Date(currentShift.startTime)) / 60000); // minutes
                
                logActivity(`Shift Closed by ${user}. End Balance: ${amount}`);
                Swal.fire('Shift Ditutup', `Shift berjalan selama ${duration} menit.`, 'success');
                currentShift = null;
                localStorage.removeItem('sotoLamonganCurrentShift');
            } else {
                // Opening Shift
                currentShift = {
                    id: Date.now(),
                    kasir: user,
                    startTime: new Date().toISOString(),
                    startBalance: amount
                };
                localStorage.setItem('sotoLamonganCurrentShift', JSON.stringify(currentShift));
                logActivity(`Shift Opened by ${user}. Start Balance: ${amount}`);
                Swal.fire('Shift Dibuka', 'Selamat bekerja!', 'success');
            }
            
            updateShiftButton();
            shiftModal.style.display = 'none';
        }

        function handleDeleteInventoryItem(e) {
            const id = parseInt(e.target.closest('button').getAttribute('data-id'));
            const item = menuItems.find(i => i.id === id);
            
            if (!item) return;

            Swal.fire({
                title: 'Hapus Barang?',
                text: `Apakah Anda yakin ingin menghapus "${item.name}"? Ini akan menghapus barang dari stok dan menu kasir secara permanen.`,
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#e63946',
                cancelButtonColor: '#2a9d8f',
                confirmButtonText: 'Ya, Hapus!',
                cancelButtonText: 'Batal'
            }).then((result) => {
                if (result.isConfirmed) {
                    // Catat riwayat penghapusan
                    stockHistory.push({
                        date: new Date(),
                        itemName: item.name,
                        type: 'delete',
                        quantity: item.stock,
                        reason: 'Barang dihapus permanen'
                    });

                    menuItems = menuItems.filter(i => i.id !== id);
                    updateInventoryTable();
                    updateMenuTable();
                    updateKasirDisplay();
                    showNotification(`Barang "${item.name}" telah dihapus.`);
                    logActivity(`Deleted Inventory Item: ${item.name}`);
                }
            });
        }

        // =================================================================================
        // UTILITY FUNCTIONS
        // =================================================================================
        
        // Backup & Restore Functions
        function backupData() {
            try {
                showLoading();
                const data = {
                    users,
                    menuItems,
                    salesData,
                    stockHistory,
                    pendingOrders
                };
                const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(data));
                const downloadAnchorNode = document.createElement('a');
                downloadAnchorNode.setAttribute("href", dataStr);
                downloadAnchorNode.setAttribute("download", "soto_lamongan_backup_" + new Date().toISOString().slice(0,10) + ".json");
                document.body.appendChild(downloadAnchorNode);
                downloadAnchorNode.click();
                downloadAnchorNode.remove();
                showNotification("Backup data berhasil diunduh");
            } catch (error) {
                console.error('Backup Error:', error);
                Swal.fire('Error', 'Gagal melakukan backup data', 'error');
            } finally {
                hideLoading();
            }
        }

        // Auto Backup every 24 hours (check on load)
        const lastBackup = localStorage.getItem('lastAutoBackup');
        if (!lastBackup || (Date.now() - parseInt(lastBackup)) > 24 * 60 * 60 * 1000) {
            // In a real app, we might save to server here. For now, we just update timestamp
            // or trigger a download if user allows.
            localStorage.setItem('lastAutoBackup', Date.now());
            console.log("Auto-backup checkpoint reached.");
        }

        function restoreData(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            showLoading();
            
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    if (data.users) users = data.users;
                    if (data.menuItems) menuItems = data.menuItems;
                    if (data.salesData) salesData = data.salesData;
                    if (data.stockHistory) stockHistory = data.stockHistory;
                    if (data.pendingOrders) pendingOrders = data.pendingOrders;
                    
                    saveUsersToLocalStorage();
                    Swal.fire('Berhasil', 'Data berhasil dipulihkan. Halaman akan dimuat ulang.', 'success').then(() => {
                        location.reload();
                    });
                } catch (err) {
                    console.error('Restore Error:', err);
                    Swal.fire('Error', 'File backup tidak valid', 'error');
                } finally {
                    hideLoading();
                }
            };
            reader.readAsText(file);
        }

        // Utility Functions
        function printReceipt() {
            const receipt = receiptContent.innerHTML;
            const originalContent = document.body.innerHTML;

            document.body.innerHTML = receipt;
            window.print();
            document.body.innerHTML = originalContent;

            // Restore event listeners
            location.reload();
        }
        

        /* Keyframes untuk animasi modal */
        const styleSheet = document.createElement("style");
        styleSheet.type = "text/css";
        styleSheet.innerText = `
            @keyframes zoomIn {
                from { opacity: 0; transform: scale(0.9); }
                to { opacity: 1; transform: scale(1); }
            }
        `;
        document.head.appendChild(styleSheet);


        function startNewOrder() {
            receiptModal.style.display = 'none';
            showNotification('Pesanan baru telah dimulai!');
        }

        function showNotification(message) {
            // Create notification element
            const notification = document.createElement('div');
            notification.textContent = message;
            notification.style.position = 'fixed';
            notification.style.top = '20px';
            notification.style.left = '20px';
            notification.style.backgroundColor = '#333';
            notification.style.color = '#fff';
            notification.style.padding = '15px 20px';
            notification.style.borderRadius = '5px';
            notification.style.boxShadow = '0 3px 10px rgba(0,0,0,0.2)';
            notification.style.zIndex = '2000'; /* Pastikan notifikasi di atas semua elemen */
            notification.classList.add('animate__animated', 'animate__fadeInLeft');

            document.body.appendChild(notification);

            // Remove notification after 3 seconds
            setTimeout(() => {
                notification.classList.remove('animate__fadeInLeft');
                notification.classList.add('animate__fadeOutLeft');
                notification.addEventListener('animationend', () => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                });
            }, 3000);
        }
    </script>

</body>

</html>